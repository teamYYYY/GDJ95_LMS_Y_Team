<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œìŠ¤í…œì‚¬ìš©ìê´€ë¦¬ | í•™ì‚¬ê´€ë¦¬ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #F5F7FA;
        }
        .admin-hero-bg {
            background-image: linear-gradient(to right, rgba(37, 99, 235, 0.9), rgba(30, 64, 175, 0.8)), url('https://images.unsplash.com/photo-1562774053-701939374585?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
        }
        .input-readonly {
            background-color: #F8F9FA;
            border-color: #E5E7EB;
            color: #6B7280;
            cursor: default;
        }
        .modal-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50; /* Tailwind z-50 */
        }
    </style>
</head>
<body class="text-gray-800">

    <header class="bg-white border-b border-gray-200">
    <div class="max-w-screen-2xl mx-auto py-3 px-6 flex items-center justify-between">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white">
                <i class="fa-solid fa-graduation-cap text-lg"></i>
            </div>
            <h1 class="text-lg font-bold text-gray-800">
                <a href="/main" class="text-gray-800 hover:text-blue-600 transition">
                    í•™ì‚¬ê´€ë¦¬ì‹œìŠ¤í…œ
                </a> 
                <span class="text-sm font-medium text-gray-500 ml-1">ê´€ë¦¬ì í˜ì´ì§€</span>
            </h1>
        </div>
        <div class="text-sm text-gray-600 flex items-center gap-4">
            <p>í™ê¸¸ë™ë‹˜ ë¡œê·¸ì¸ ì¤‘ì…ë‹ˆë‹¤</p> 
            <a href="/logout" class="text-red-500 hover:text-red-600 transition flex items-center gap-1">
                <i class="fa-solid fa-right-from-bracket text-xs"></i> ë¡œê·¸ì•„ì›ƒ
            </a>
        </div>
    </div>
	</header>

    <div class="admin-hero-bg h-40 p-8 text-white">
        <div class="max-w-screen-2xl mx-auto h-full flex flex-col justify-end">
            <h2 class="text-3xl font-bold">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h2>
            <p class="text-sm text-gray-200 mt-2">ì‹œìŠ¤í…œ ê´€ë¦¬ ë° ì„¤ì •</p>
        </div>
    </div>

    <div class="flex min-h-[calc(100vh-16rem)]">
        
        <aside class="w-64 bg-white border-r border-gray-200 shadow-md flex-shrink-0">
            <nav class="p-4 space-y-1">
                <a href="/myInfo/userInfo" class="flex items-center gap-3 p-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                    <i class="fa-solid fa-user-gear w-5"></i> ê°œì¸ì •ë³´ê´€ë¦¬
                </a>
                <a href="/admin/userManagement" class="flex items-center gap-3 p-3 rounded-lg bg-blue-50 text-blue-700 font-semibold transition">
                    <i class="fa-solid fa-users-gear w-5"></i> ì‹œìŠ¤í…œ ì‚¬ìš©ì ê´€ë¦¬
                    <i class="fa-solid fa-chevron-right ml-auto text-xs"></i>
                </a>
                <a href="/admin/sysAuthManagement" class="flex items-center gap-3 p-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                    <i class="fa-solid fa-user-lock w-5"></i> ì‚¬ìš©ìê¶Œí•œê´€ë¦¬
                </a>
                <a href="/admin/deptManagement" class="flex items-center gap-3 p-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                    <i class="fa-solid fa-book-open-reader w-5"></i> í•™ê³¼ê´€ë¦¬
                </a>
                <a href="#" class="flex items-center gap-3 p-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                    <i class="fa-regular fa-bell w-5"></i> ê³µì§€ì‚¬í•­ê´€ë¦¬
                </a>
            </nav>
        </aside>
		<!--  ì—¬ê¸°ë¶€í„° ë™ì  -->
        <main class="flex-grow p-8 max-w-screen-2xl mx-auto">
            <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-100">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">ì‹œìŠ¤í…œ ì‚¬ìš©ì ê´€ë¦¬</h2>
                <p class="text-gray-500 mb-6">ì‹œìŠ¤í…œ ì‚¬ìš©ìë¥¼ ì¡°íšŒí•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

                <div class="mb-8 p-4 border rounded-lg bg-gray-50">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">ì‚¬ìš©ì ì¡°íšŒ</h3>
                    <p class="text-sm text-gray-500 mb-3">ì‚¬ìš©ì ID, ì´ë¦„, ì´ë©”ì¼ ë“±ìœ¼ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    <div class="flex gap-2">
                        <input type="text" id="searchCondition" placeholder="ì‚¬ìš©ì ID ë˜ëŠ” ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" class="flex-grow px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                        <button id="searchBtn" class="px-5 py-2.5 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition flex items-center gap-1">
                            <i class="fa-solid fa-magnifying-glass"></i> ì¡°íšŒ
                        </button>
                    </div>
                </div>
                
                <div class="flex justify-between items-center mb-4">
                    <p class="text-gray-700 font-medium">ì‚¬ìš©ì ëª©ë¡ <span class="text-sm text-gray-500 ml-1" id="totalCountDisplay">ì´ {{totalCount}}ëª…ì˜ ì‚¬ìš©ì</span></p>
                    <div class="flex gap-2">
                        <button class="px-3 py-1.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition flex items-center gap-1 text-sm">
                            <i class="fa-solid fa-download"></i> ëª©ë¡ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
                        </button>
                        <button class="px-3 py-1.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition flex items-center gap-1 text-sm">
                            <i class="fa-solid fa-file-excel"></i> ì–‘ì‹ ë‹¤ìš´ë¡œë“œ
                        </button>
                        <button onclick="openBatchUploadModal()" class="px-3 py-1.5 bg-green-500 text-white rounded-lg hover:bg-green-600 transition flex items-center gap-1 text-sm">
                            <i class="fa-solid fa-upload"></i> ì¼ê´„ ì—…ë¡œë“œ
                        </button>
                        <button onclick="openRegisterModal()" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-1 text-sm">
                            <i class="fa-solid fa-plus"></i> ë“±ë¡
                        </button>
                    </div>
                </div>

                <div class="overflow-x-auto border rounded-lg">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="w-10 px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"><input type="checkbox" id="selectAll"></th>
                                <th class="w-10 px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">No.</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">í•™ë²ˆ (ID)</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì´ë¦„</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì´ë©”ì¼</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì†Œì†</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ê¶Œí•œ</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ê³„ì •ìƒíƒœ</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ë“±ë¡ì¼</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="userListBody">
                            {{#userList}}
                            <tr>
                                <td class="px-4 py-3 whitespace-nowrap text-center"><input type="checkbox" name="selectedUser" data-user-no="{{userNo}}"></td>
                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">{{userNo}}</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                                    <a href="#" onclick="openUserDetailModal('{{userId}}')" class="text-blue-600 hover:underline">{{userId}}</a>
                                </td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">{{userName}}</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">{{userEmail}}</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">{{deptName}}</td>
                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-blue-600">{{authName}}</td>
                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm 
                                    {{#isRetire}}text-red-600{{/isRetire}}
                                    {{^isRetire}}{{#isActive}}text-green-600{{/isActive}}{{^isActive}}text-red-600{{/isActive}}{{/isRetire}}
                                ">{{statusName}}</td>
                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">{{createDate}}</td>
                            </tr>
                            {{/userList}}
                        </tbody>
                    </table>
                </div>

                <div class="mt-4 flex justify-between items-center">
                    <button id="retireSelectedBtn" class="px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition disabled:bg-red-300" disabled>
                        <i class="fa-solid fa-user-slash mr-1"></i> ê³„ì • íì§€
                    </button>
                    <div class="flex items-center space-x-1" id="pagination">
                        {{#showPrev}}
                        <a href="/admin/userManagement?page={{prevPage}}&limit=10" class="px-3 py-1 border rounded-lg text-gray-500 hover:bg-gray-100">ì´ì „</a>
                        {{/showPrev}}
                        {{^showPrev}}
                        <span class="px-3 py-1 border rounded-lg text-gray-300 cursor-not-allowed">ì´ì „</span>
                        {{/showPrev}}

                        {{#pageNumbers}}
                        <a href="/admin/userManagement?page={{number}}&limit=10" 
                           class="px-3 py-1 border rounded-lg {{#isActive}}bg-blue-600 text-white{{/isActive}}{{^isActive}}text-gray-700 hover:bg-gray-100{{/isActive}}">{{number}}</a>
                        {{/pageNumbers}}

                        {{#showNext}}
                        <a href="/admin/userManagement?page={{nextPage}}&limit=10" class="px-3 py-1 border rounded-lg text-gray-500 hover:bg-gray-100">ë‹¤ìŒ</a>
                        {{/showNext}}
                        {{^showNext}}
                        <span class="px-3 py-1 border rounded-lg text-gray-300 cursor-not-allowed">ë‹¤ìŒ</span>
                        {{/showNext}}
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ì—‘ì…€ ê¸°ëŠ¥ -->

    <div id="batchUploadModal" class="modal-container hidden">
        <div class="bg-white w-full max-w-lg rounded-xl shadow-2xl transform transition-all duration-300 scale-100">
            <div class="p-6">
                <div class="flex justify-between items-center pb-4 border-b">
                    <h3 class="text-2xl font-bold text-gray-900">ê¶Œí•œ ì¼ê´„ ì—…ë¡œë“œ</h3>
                    <button onclick="closeBatchUploadModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fa-solid fa-xmark text-2xl"></i>
                    </button>
                </div>

                <div class="mt-6 text-center space-y-4">
                    <p class="text-gray-600">ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ì—¬ëŸ¬ ë°ì´í„°ë¥¼ í•œë²ˆì— ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    <div class="border-2 border-dashed border-gray-300 p-10 rounded-lg text-gray-500">
                        <i class="fa-solid fa-cloud-upload-alt text-4xl mb-3"></i>
                        <p>íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</p>
                        <p class="text-sm">.xlsx, .xls íŒŒì¼ë§Œ ì§€ì›ë©ë‹ˆë‹¤</p>
                        <button class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition">
                            íŒŒì¼ ì„ íƒ
                        </button>
                    </div>
                    
                    <div class="text-left bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-md text-sm text-yellow-800">
                        <p class="font-semibold mb-2 flex items-center"><i class="fa-solid fa-circle-exclamation mr-2"></i> ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œ ì‹œ ì£¼ì˜ì‚¬í•­</p>
                        <ul class="list-disc list-inside space-y-1">
                            <li>ì—‘ì…€ íŒŒì¼ í˜•ì‹(.xlsx, .xls)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
                            <li>ì œê³µëœ ì–‘ì‹ì˜ í•­ëª©ê³¼ ìˆœì„œë¥¼ ë³€ê²½í•˜ì§€ ë§ˆì„¸ìš”.</li>
                            <li>í•„ìˆ˜ í•­ëª©ì€ ë°˜ë“œì‹œ ì…ë ¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</li>
                            <li>ìµœëŒ€ 1000ê°œì˜ ë°ì´í„°ê¹Œì§€ í•œë²ˆì— ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                            <li>ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•Šìœ¼ë©´ ë“±ë¡ì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                            <li>ì¤‘ë³µëœ ë°ì´í„°ëŠ” ìë™ìœ¼ë¡œ ì œì™¸ë©ë‹ˆë‹¤.</li>
                        </ul>
                    </div>
                </div>

                <div class="pt-6 border-t mt-6 flex justify-end space-x-3">
                    <button type="button" onclick="closeBatchUploadModal()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition">ì·¨ì†Œ</button>
                    <button type="button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition">ì—…ë¡œë“œ</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="userCrudModal" class="modal-container hidden">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl p-6 relative">
        <button class="absolute top-4 right-4 text-gray-400 hover:text-gray-600" onclick="closeUserCrudModal()">
            <i class="fa-solid fa-xmark"></i>
        </button>
        <h3 id="modalTitle" class="text-xl font-bold mb-4 border-b pb-2">ì‚¬ìš©ì ë“±ë¡</h3>
        <p id="modalSubtitle" class="text-sm text-gray-500 mb-4">* í‘œì‹œëŠ” í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤</p>
        
        <form id="userForm" class="space-y-4">
            <input type="hidden" id="userNo" name="userNo" />
            <input type="hidden" id="userLastLogin" name="userLastLogin" />
            <input type="hidden" id="userLoginFailCnt" name="userLoginFailCnt" />
            <input type="hidden" id="createDate" name="createDate" />
            <input type="hidden" id="updateDate" name="updateDate" />

            <div class="grid grid-cols-3 gap-4">
                <div>
                    <label for="userId" class="block text-sm font-medium text-gray-700 mb-1">ì‚¬ìš©ì ID (í•™ë²ˆ) *</label>
                    <input type="text" id="userId" name="userId" required placeholder="IDë¥¼ ì…ë ¥í•˜ì„¸ìš”" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
                </div>
                <div>
                    <label for="userName" class="block text-sm font-medium text-gray-700 mb-1">ì´ë¦„ *</label>
                    <input type="text" id="userName" name="userName" required placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
                </div>
                <div id="passwordField">
                    <label for="userPassword" class="block text-sm font-medium text-gray-700 mb-1">ë¹„ë°€ë²ˆí˜¸ *</label>
                    <input type="password" id="userPassword" name="userPassword" required placeholder="********" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
                </div>
            </div>
            
            <div class="grid grid-cols-3 gap-4">
                <div>
                    <label for="userEmail" class="block text-sm font-medium text-gray-700 mb-1">ì´ë©”ì¼</label>
                    <input type="email" id="userEmail" name="userEmail" placeholder="email@example.com" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
                </div>
                <div>
                    <label for="userPhone" class="block text-sm font-medium text-gray-700 mb-1">íœ´ëŒ€í° ë²ˆí˜¸</label>
                    <input type="text" id="userPhone" name="userPhone" placeholder="010-0000-0000" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
                </div>
                <div>
                    <label for="userBirth" class="block text-sm font-medium text-gray-700 mb-1">ìƒë…„ì›”ì¼</label>
                    <input type="date" id="userBirth" name="userBirth" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
                </div>
            </div>

            <div class="grid grid-cols-3 gap-4">
                <div>
                    <label for="userAuth" class="block text-sm font-medium text-gray-700 mb-1">ì‚¬ìš©ì ê¶Œí•œ *</label>
                    <select id="userAuth" name="userAuth" required class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
                        <option value="">ê¶Œí•œì„ ì„ íƒí•˜ì„¸ìš”</option>
                        {{#metaData.authList}}
                            <option value="{{authCode}}">{{authName}}</option>
                        {{/metaData.authList}}
                    </select>
                </div>
				<div>
		            <label for="userDetailAuth" class="block text-sm font-medium text-gray-700 mb-1">ì‚¬ìš©ì ì„¸ë¶€ ê¶Œí•œ *</label>
		            <select id="userDetailAuth" name="userDetailAuth" required class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
		                <option value="">ì„¸ë¶€ ê¶Œí•œì„ ì„ íƒí•˜ì„¸ìš”</option>
	                </select>
      		  	</div>
                <div>
                    <label for="userStatus" class="block text-sm font-medium text-gray-700 mb-1">ì‚¬ìš©ì ê³„ì • ìƒíƒœ *</label>
                    <select id="userStatus" name="userStatus" required class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
                        <option value="">ìƒíƒœë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        {{#metaData.statusList}}
                            <option value="{{statusCode}}">{{statusName}}</option>
                        {{/metaData.statusList}}
                    </select>
                </div>
            </div>
            
            <div class="grid grid-cols-3 gap-4">
                <div>
                    <label for="deptCode" class="block text-sm font-medium text-gray-700 mb-1">í•™ê³¼</label>
                    <select id="deptCode" name="deptCode" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
                        <option value="">í•™ê³¼ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        {{#metaData.deptList}}
                            <option value="{{deptCode}}">{{deptName}}</option>
                        {{/metaData.deptList}}
                    </select>
                </div>
                <div>
                    <label for="userGrade" class="block text-sm font-medium text-gray-700 mb-1">í•™ë…„</label>
                    <select id="userGrade" name="userGrade" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
                        <option value="">í•™ë…„ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="1">1í•™ë…„</option>
                        <option value="2">2í•™ë…„</option>
                        <option value="3">3í•™ë…„</option>
                        <option value="4">4í•™ë…„</option>
                    </select>
                </div>
            </div>
            
            <div>
                <label for="userZipcode" class="block text-sm font-medium text-gray-700 mb-1">ìš°í¸ë²ˆí˜¸</label>
                <input type="text" id="userZipcode" name="userZipcode" placeholder="ìš°í¸ë²ˆí˜¸"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
            </div>
            <div>
                <label for="userAddr" class="block text-sm font-medium text-gray-700 mb-1">ê¸°ë³¸ ì£¼ì†Œ</label>
                <input type="text" id="userAddr" name="userAddr" placeholder="ê¸°ë³¸ ì£¼ì†Œ"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
            </div>
            <div>
                <label for="userAddrDetail" class="block text-sm font-medium text-gray-700 mb-1">ìƒì„¸ ì£¼ì†Œ</label>
                <input type="text" id="userAddrDetail" name="userAddrDetail" placeholder="ìƒì„¸ ì£¼ì†Œ"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
            </div>

            <div class="pt-4 border-t flex justify-end gap-2">
                <button type="submit" id="registerButtons" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    <i class="fa-solid fa-floppy-disk mr-1"></i> ë“±ë¡
                </button>
                
                <div id="detailButtons" class="hidden">
                    <button type="button" onclick="enterDetailEditMode()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                        <i class="fa-solid fa-pen-to-square mr-1"></i> ë³€ê²½
                    </button>
                </div>
                
                <div id="editBtns" class="hidden">
                    <button type="button" onclick="cancelDetailEditMode()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                        <i class="fa-solid fa-xmark mr-1"></i> ì·¨ì†Œ
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        <i class="fa-solid fa-floppy-disk mr-1"></i> ì €ì¥
                    </button>
                </div>
                
                <button type="button" onclick="closeUserCrudModal()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                    <i class="fa-solid fa-times mr-1"></i> ë‹«ê¸°
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
    const batchModal = document.getElementById('batchUploadModal');
    const userCrudModal = document.getElementById('userCrudModal');
    const userForm = document.getElementById('userForm');
    const modalTitle = document.getElementById('modalTitle');
    const modalSubtitle = document.getElementById('modalSubtitle');
    
    const registerBtns = document.getElementById('registerButtons');
    const detailBtns = document.getElementById('detailButtons');
    const editBtns = document.getElementById('editBtns');
    
    const passwordFieldDiv = document.getElementById('passwordField');
    const passwordInput = document.getElementById('userPassword');
    const userIdInput = document.getElementById('userId');
    
    // [AJAX í†µì‹  ë° ëª©ë¡ ê°±ì‹ ì„ ìœ„í•œ ë³€ìˆ˜]
    const userListBody = document.getElementById('userListBody');
    const searchConditionInput = document.getElementById('searchCondition');
    const searchBtn = document.getElementById('searchBtn');
    const retireSelectedBtn = document.getElementById('retireSelectedBtn');
    const totalCountDisplay = document.getElementById('totalCountDisplay');
    const paginationDiv = document.getElementById('pagination'); 
    
    let originalDetailData = {}; 
    
    // input-field í´ë˜ìŠ¤ë¥¼ ê°€ì§„ ëª¨ë“  ì…ë ¥/ì„ íƒ í•„ë“œ (ìˆ¨ê¹€ í•„ë“œ ì œì™¸)
    const inputFields = document.querySelectorAll('#userCrudModal .input-field');

    // ğŸš€ ê²€ìƒ‰ ìƒíƒœ ìœ ì§€ë¥¼ ìœ„í•œ ì „ì—­ ë³€ìˆ˜ ì¶”ê°€ ğŸš€
    let currentSearchCondition = ''; // í˜„ì¬ ê²€ìƒ‰ì–´
    let currentPageNo = 1;         // í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸

    // ğŸš€ ê¶Œí•œ ì„ íƒ ìš”ì†Œ ì „ì—­ ë³€ìˆ˜ ì¶”ê°€ ğŸš€
    const userAuthSelect = document.getElementById('userAuth');
    const userDetailAuthSelect = document.getElementById('userDetailAuth');


	 // ------------------------
	 // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜: í¼ì— ë°ì´í„° ë°”ì¸ë”©
	 // ------------------------
	 function bindFormData(data) {
	     for (const key in data) {
	         const input = document.getElementById(key);
	         
	         if (input) { 
	             // ğŸš€ ìˆ˜ì • í›„: í•´ë‹¹ ì¡°ê±´ ì—†ì´ ëª¨ë“  í•„ë“œë¥¼ ë°”ì¸ë”©í•˜ë„ë¡ í•©ë‹ˆë‹¤.
	             input.value = (data[key] === null || data[key] === undefined) ? '' : data[key].toString(); 
	         }
	     }
	     
	     const userNoInput = document.getElementById('userNo');
	     if (userNoInput) {
	         userNoInput.value = data.userNo || ''; 
	     }
	     
	     if (passwordInput) {
	         passwordInput.value = '********'; 
	         passwordInput.setAttribute('type', 'text');
	     }
	 }

    // ------------------------
    // ğŸ’¡ ì¶”ê°€ëœ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜: ì…ë ¥ í•„ë“œ ì½ê¸° ì „ìš© ìƒíƒœ í† ê¸€ (userId ì˜ˆì™¸ ì²˜ë¦¬ ì œê±°)
    // ------------------------
    function toggleInputReadOnly(isReadOnly, preservePassword) {
        inputFields.forEach(input => {
            // ğŸŸ¢ ìˆ˜ì •: userId ì˜ˆì™¸ ì²˜ë¦¬ ì œê±°. userNoë§Œ ì˜ˆì™¸ ì²˜ë¦¬ ğŸŸ¢
            if (input.id !== 'userNo') {
                input.readOnly = isReadOnly;
                input.disabled = isReadOnly;
                
                if (isReadOnly) {
                    input.classList.add('input-readonly');
                } else {
                    input.classList.remove('input-readonly');
                }
            }
        });

        // ë¹„ë°€ë²ˆí˜¸ í•„ë“œ ì²˜ë¦¬
        if (!preservePassword) {
            passwordInput.readOnly = isReadOnly;
            passwordInput.disabled = isReadOnly;
            if (isReadOnly) {
                passwordInput.classList.add('input-readonly');
            } else {
                passwordInput.classList.remove('input-readonly');
            }
        }
        
        // ğŸš€ ì¶”ê°€: ë™ì ìœ¼ë¡œ ë¡œë“œë˜ëŠ” Select ë°•ìŠ¤ì˜ disabled ì²˜ë¦¬
        if (userAuthSelect) userAuthSelect.disabled = isReadOnly;
        if (userDetailAuthSelect) userDetailAuthSelect.disabled = isReadOnly;
    }

    // ------------------------
    // ğŸš€ ì¶”ê°€: ì„¸ë¶€ ê¶Œí•œ ë™ì  ë¡œë”© ë° ë Œë”ë§ í•¨ìˆ˜
    // ------------------------
    function loadAndRenderAuthDetails(authCode, selectedDetailCode) {
        
        // 1. ì´ˆê¸°í™”
        userDetailAuthSelect.innerHTML = '<option value="">ì„¸ë¶€ ê¶Œí•œì„ ì„ íƒí•˜ì„¸ìš”</option>';
        if (!authCode) {
            return; 
        }

        // 2. AJAX í˜¸ì¶œ
        $.ajax({
            url: '/admin/getAuthDetailListByAuthCode',
            type: 'GET',
            data: { authCode: authCode },
            success: function(response) {
                if (response.status === 'success' && response.detailList) {
                    let html = '<option value="">ì„¸ë¶€ ê¶Œí•œì„ ì„ íƒí•˜ì„¸ìš”</option>';
                    
                    response.detailList.forEach(item => {
                        // ì„ íƒëœ detailCodeê°€ ìˆìœ¼ë©´ selected ì†ì„± ì¶”ê°€
                        const isSelected = (item.authDetailCode === selectedDetailCode) ? 'selected' : '';
                        html += `<option value="${item.authDetailCode}" ${isSelected}>${item.authDetailName}</option>`;
                    });
                    
                    userDetailAuthSelect.innerHTML = html;
                } else {
                    console.error("ì„¸ë¶€ ê¶Œí•œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                }
            },
            error: function() {
                console.error("ì„¸ë¶€ ê¶Œí•œ ì¡°íšŒ ì„œë²„ í†µì‹  ì˜¤ë¥˜");
            }
        });
    }
    
    // ------------------------
    // ğŸ’¡ ì¶”ê°€ëœ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜: ì‚¬ìš©ì ëª©ë¡ í…Œì´ë¸” ë Œë”ë§
    // ------------------------
    function renderUserTable(userList) {
        // ... (ê¸°ì¡´ ë¡œì§ ë™ì¼) ...
        let html = '';
        
        const statusMap = {
            '0': { name: 'ì‚¬ìš©ëŒ€ê¸°', class: 'text-blue-600' }, 
            '1': { name: 'ì‚¬ìš©ì¤‘', class: 'text-green-600' }, 
            '2': { name: 'ë¯¸ì‚¬ìš©', class: 'text-orange-600' }, 
            '3': { name: 'íì§€', class: 'text-gray-600' } 
        };
        
        if (userList && userList.length > 0) {
            userList.forEach((user) => {
            	// ğŸš€ ìˆ˜ì •: userStatusë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ Mapì— ì ‘ê·¼í•©ë‹ˆë‹¤.
                const statusKey = user.userStatus !== null && user.userStatus !== undefined
                                  ? user.userStatus.toString() 
                                  : ''; // null/undefined ëŒ€ë¹„
                                  
                const statusInfo = statusMap[statusKey] || { name: 'ì•Œ ìˆ˜ ì—†ìŒ', class: 'text-gray-500' };
                
                const statusClass = statusInfo.class;
                const statusName = statusInfo.name;
                
                html += `
                    <tr>
                        <td class="px-4 py-3 whitespace-nowrap text-center"><input type="checkbox" name="selectedUser" data-user-no="${user.userNo}"></td>
                        <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">${user.userNo}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                            <a href="#" onclick="openUserDetailModal('${user.userId}')" class="text-blue-600 hover:underline">${user.userId}</a>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">${user.userName}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">${user.userEmail || '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">${user.deptName || '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-blue-600">${user.authName}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-center text-sm ${statusClass}">${statusName}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">${user.createDate}</td>
                    </tr>
                `;
            });
        } else {
             html += `
                <tr>
                    <td colspan="9" class="px-4 py-3 whitespace-nowrap text-center text-gray-500">ì¡°íšŒëœ ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                </tr>
            `;
        }
        
        userListBody.innerHTML = html;
        // ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì´ˆê¸°í™” ë° ë²„íŠ¼ ê°±ì‹ 
        const selectAll = document.getElementById('selectAll');
        if (selectAll) selectAll.checked = false;
        updateRetireButtonState();
    }


    // ------------------------
    // ğŸ’¡ ìµœì¢… í†µí•©ëœ í•¨ìˆ˜: renderPagination
    // ------------------------
    function renderPagination(totalCount, currentPage, pageSize = 10) {
        const totalPages = Math.ceil(totalCount / pageSize);
        
        // ... (ê¸°ì¡´ ë¡œì§ ë™ì¼) ...
        
        // ì´ ê°œìˆ˜ í‘œì‹œ ê°±ì‹ 
        totalCountDisplay.textContent = `ì´ ${totalCount}ëª…ì˜ ì‚¬ìš©ì`;
        
        if (totalPages <= 1) {
            paginationDiv.innerHTML = '';
            paginationDiv.style.display = 'none';
            return;
        }

        let html = '';
        html += '<nav class="flex items-center space-x-1">';
        
        // --- 1. í˜ì´ì§€ ë¸”ë¡ ê³„ì‚° (10ê°œ) ---
        const pagesPerBlock = 10;
        const currentBlock = Math.floor((currentPage - 1) / pagesPerBlock);
        const blockStart = currentBlock * pagesPerBlock + 1;
        const blockEnd = Math.min(blockStart + pagesPerBlock - 1, totalPages);
        
        
        // --- 2. ì´ì „ í˜ì´ì§€ ë²„íŠ¼ (â—€) ---
        const prevPage = currentPage - 1;
        const prevDisabled = (currentPage === 1) ? 'opacity-50 cursor-not-allowed' : '';
        html += `<a href="#" data-page="${prevPage > 0 ? prevPage : 1}" 
                     class="page-link px-3 py-1 text-sm font-medium rounded-lg text-gray-700 hover:bg-gray-100 ${prevDisabled}">â—€</a>`;


        // --- 3. í˜ì´ì§€ ë²ˆí˜¸ ë§í¬ (ë¸”ë¡ ë‚´) ---
        for (let i = blockStart; i <= blockEnd; i++) {
            const activeClass = (i === currentPage) ? 'bg-blue-600 text-white' : 'text-gray-700 hover:bg-gray-100';
            html += `<a href="#" data-page="${i}" 
                       class="page-link px-3 py-1 text-sm font-medium rounded-lg ${activeClass}">${i}</a>`;
        }

        // --- 4. ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼ (â–¶) ---
        const nextPage = currentPage + 1;
        const nextDisabled = (currentPage === totalPages) ? 'opacity-50 cursor-not-allowed' : '';
        html += `<a href="#" data-page="${nextPage <= totalPages ? nextPage : totalPages}" 
                     class="page-link px-3 py-1 text-sm font-medium rounded-lg text-gray-700 hover:bg-gray-100 ${nextDisabled}">â–¶</a>`;
        
        
        html += '</nav>';
        
        paginationDiv.innerHTML = html;
        paginationDiv.style.display = 'flex';
        
        // --- 5. ì´ë²¤íŠ¸ ìœ„ì„ (í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬) ---
        paginationDiv.querySelectorAll('.page-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                
                const clickedLink = e.target.closest('a.page-link');
                if (!clickedLink) return;

                const targetPage = parseInt(clickedLink.dataset.page);
                
                if (clickedLink.classList.contains('cursor-not-allowed') || targetPage < 1 || targetPage > totalPages) return;

                if (typeof searchAndRenderUser === 'function') {
                    searchAndRenderUser(targetPage); 
                } else {
                     console.error("searchAndRenderUser í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                }
            });
        });
    }

    // ------------------------
    // í•µì‹¬ í•¨ìˆ˜: ê²€ìƒ‰ ë° í˜ì´ì§€ ì´ë™ AJAX ìš”ì²­ (ìƒíƒœ ì €ì¥ ë¡œì§ ì¶”ê°€)
    // ------------------------
    function searchAndRenderUser(pageNo) {
        // ... (ê¸°ì¡´ ë¡œì§ ë™ì¼) ...
        const condition = searchConditionInput.value.trim();
        
        // ğŸš€ ìƒíƒœ ê°±ì‹ 
        currentSearchCondition = condition; 
        currentPageNo = pageNo;
        // -------------------

        $.ajax({
            url: '/admin/searchUserInfo',
            type: 'GET',
            data: { 
                searchCondition: condition,
                currentPage: pageNo 
            },
            success: function(response) {
                if (response.status === 'success') {
                    renderUserTable(response.userList);
                    renderPagination(response.totalCount, response.currentPage);
                    // ğŸ’¡ ê²€ìƒ‰ ì¡°ê±´ input í•„ë“œì— í˜„ì¬ ê²€ìƒ‰ì–´ë¥¼ ë‹¤ì‹œ ì„¤ì •
                    searchConditionInput.value = currentSearchCondition;
                } else {
                    alert('ì‚¬ìš©ì ê²€ìƒ‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            },
            error: function() {
                alert('ì„œë²„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        });
    }


    // ------------------------
    // ëª¨ë‹¬ ì œì–´ í•¨ìˆ˜
    // ------------------------
    function openBatchUploadModal() {
        batchModal.classList.remove('hidden');
        batchModal.classList.add('flex');
    }

    function closeBatchUploadModal() {
        batchModal.classList.add('hidden');
        batchModal.classList.remove('flex');
    }
    
    function closeUserCrudModal() {
        userCrudModal.classList.add('hidden');
        userCrudModal.classList.remove('flex');
        userForm.reset();
        
        // ë“±ë¡ ëª¨ë“œ ëŒ€ë¹„: userIdInputì˜ readonly/ìŠ¤íƒ€ì¼ ì œê±°
        userIdInput.removeAttribute('readonly');
        userIdInput.classList.remove('input-readonly');
        
        // ğŸš€ ìˆ˜ì •ëœ ë¡œì§: location.reload() ëŒ€ì‹  í˜„ì¬ ìƒíƒœë¥¼ ìœ ì§€í•˜ë©° ëª©ë¡ ê°±ì‹ 
        searchConditionInput.value = currentSearchCondition; 
        searchAndRenderUser(currentPageNo); 
    }

    function openRegisterModal() {
        userForm.reset();
        modalTitle.textContent = "ì‚¬ìš©ì ë“±ë¡";
        modalSubtitle.textContent = "* í‘œì‹œëŠ” í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤";
        toggleInputReadOnly(false, false); 
        registerBtns.classList.remove('hidden');
        detailBtns.classList.add('hidden');
        editBtns.classList.add('hidden');
        passwordInput.required = true; 
        userIdInput.removeAttribute('readonly'); 
        userCrudModal.classList.remove('hidden');
        userCrudModal.classList.add('flex');
        
        // ğŸš€ ì¶”ê°€: ë“±ë¡ ëª¨ë“œ ì‹œ ì„¸ë¶€ ê¶Œí•œ ì´ˆê¸°í™”
        loadAndRenderAuthDetails(userAuthSelect.value, null); 
    }

    function openUserDetailModal(userId) {
        $.ajax({
            url: '/admin/getUserDetail',
            type: 'GET',
            data: { userId: userId },
            success: function(response) {
                if (response.status === 'success') {
                    const data = response.data;
                    originalDetailData = data; 
                    
                    // 1. ì¼ë°˜ í•„ë“œ ë°”ì¸ë”© 
                    bindFormData(data); 
                    
                	// âŒ ìƒì„¸ ì •ë³´ ì¡°íšŒ ì‹œ userIdë¥¼ readonly ì²˜ë¦¬í•˜ëŠ” ë¡œì§ ì œê±°.
                    //    toggleInputReadOnly(true, true)ê°€ ëª¨ë“  í•„ë“œë¥¼ readonlyë¡œ ë§Œë“­ë‹ˆë‹¤.

                    // 2. ğŸš€ ì„¸ë¶€ ê¶Œí•œ ë™ì  ë¡œë”© ë° ê¸°ì¡´ ê°’ ì„ íƒ
                    const authCode = data.userAuth; 
                    const detailCode = data.userDetailAuth; 
                    
                    if (authCode) {
                        loadAndRenderAuthDetails(authCode, detailCode); 
                    } else {
                        // userAuthê°€ ì—†ëŠ” ê²½ìš° ì„¸ë¶€ ê¶Œí•œ ì´ˆê¸°í™”
                         loadAndRenderAuthDetails(null, null); 
                    }
                    // ------------------------------------

                    modalTitle.textContent = "ì‚¬ìš©ì ìƒì„¸ ì •ë³´ (" + userId + ")";
                    modalSubtitle.textContent = "ì‚¬ìš©ì ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤. (ë³€ê²½ ë²„íŠ¼ì„ ëˆŒëŸ¬ ìˆ˜ì • ê°€ëŠ¥)";
                    
                    // ğŸŸ¢ ì—¬ê¸°ì„œ userIdë¥¼ í¬í•¨í•œ ëª¨ë“  í•„ë“œë¥¼ readonlyë¡œ ë§Œë“­ë‹ˆë‹¤.
                    toggleInputReadOnly(true, true); 
                    
                    detailBtns.classList.remove('hidden');
                    registerBtns.classList.add('hidden');
                    editBtns.classList.add('hidden');
                    userCrudModal.classList.remove('hidden');
                    userCrudModal.classList.add('flex');
                } else {
                    alert('ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + response.message);
                }
            },
            error: function() {
                alert('ì„œë²„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        });
    }

    function enterDetailEditMode() {
        modalTitle.textContent = "ì‚¬ìš©ì ì •ë³´ ìˆ˜ì •";
        modalSubtitle.textContent = "ì •ë³´ë¥¼ ìˆ˜ì • í›„ ì €ì¥í•´ì£¼ì„¸ìš”. (ë¹„ë°€ë²ˆí˜¸ ë¯¸ì…ë ¥ ì‹œ ë³€ê²½ ì—†ìŒ)";
        
        // ğŸŸ¢ ì—¬ê¸°ì„œ userIdë¥¼ í¬í•¨í•œ ëª¨ë“  í•„ë“œì˜ readonlyë¥¼ í•´ì œí•©ë‹ˆë‹¤.
        toggleInputReadOnly(false, true); 
        
        editBtns.classList.remove('hidden');
        detailBtns.classList.add('hidden');
        registerBtns.classList.add('hidden');
        
        // âŒ userIdInputì„ readonlyë¡œ ìœ ì§€í•˜ëŠ” ë¡œì§ì„ ì œê±°í•©ë‹ˆë‹¤. 
        //    ì´ì œ userIdInputì€ ìˆ˜ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.
        
        passwordInput.setAttribute('type', 'password'); 
        passwordInput.removeAttribute('readonly');
        passwordInput.classList.remove('input-readonly');
        passwordInput.disabled = false;
        passwordInput.required = false; 
        passwordInput.value = ''; 
    }

    function cancelDetailEditMode() {
        bindFormData(originalDetailData); 
        
        // ğŸš€ ì¶”ê°€: ìˆ˜ì • ì·¨ì†Œ ì‹œ ì„¸ë¶€ ê¶Œí•œë„ ì›ë³¸ ë°ì´í„°ë¡œ ë³µì›
        const authCode = originalDetailData.userAuth; 
        const detailCode = originalDetailData.userDetailAuth; 
        loadAndRenderAuthDetails(authCode, detailCode);
        
        modalTitle.textContent = "ì‚¬ìš©ì ìƒì„¸ ì •ë³´ (" + userIdInput.value + ")";
        modalSubtitle.textContent = "ì‚¬ìš©ì ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤. (ë³€ê²½ ë²„íŠ¼ì„ ëˆŒëŸ¬ ìˆ˜ì • ê°€ëŠ¥)";
        
        // ğŸŸ¢ ì—¬ê¸°ì„œ userIdë¥¼ í¬í•¨í•œ ëª¨ë“  í•„ë“œë¥¼ ë‹¤ì‹œ readonlyë¡œ ë§Œë“­ë‹ˆë‹¤.
        toggleInputReadOnly(true, true); 
        
        detailBtns.classList.remove('hidden');
        editBtns.classList.add('hidden');
    }

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            closeBatchUploadModal();
            closeUserCrudModal();
        }
    });
    
    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (ì²´í¬ë°•ìŠ¤ ìƒíƒœ) - DOMContentLoaded ë°–ìœ¼ë¡œ ì´ë™í•˜ì—¬ ì „ì—­ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ í•¨
    function updateRetireButtonState() {
        const checkedCount = document.querySelectorAll('input[name="selectedUser"]:checked').length;
        retireSelectedBtn.disabled = checkedCount === 0;
    }


    // ------------------------
    // DOMContentLoaded ì´ë²¤íŠ¸ ë° AJAX ìš”ì²­ (ìƒíƒœ ì´ˆê¸°í™” ë¡œì§ ì¶”ê°€)
    // ------------------------
    document.addEventListener('DOMContentLoaded', () => {
        const selectAll = document.getElementById('selectAll');
        const retireBtn = document.getElementById('retireSelectedBtn'); 
        
        // ... (ê¸°ì¡´ ì´ˆê¸°í™” ë¡œì§ ë™ì¼) ...
        const initialTotalCount = {{totalCount}}; 
        const initialCurrentPage = {{currentPage}}; 
        
        currentPageNo = initialCurrentPage;
        currentSearchCondition = searchConditionInput.value.trim() || ''; 


        if (initialTotalCount > 0) {
            renderPagination(initialTotalCount, initialCurrentPage);
        }
        
        // ğŸš€ í•µì‹¬: userAuth ë³€ê²½ ì‹œ ì„¸ë¶€ ê¶Œí•œ ë™ì  ë¡œë”© ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        if (userAuthSelect && userDetailAuthSelect) {
            userAuthSelect.addEventListener('change', function() {
                // ì„ íƒëœ authCodeë¡œ ì„¸ë¶€ ê¶Œí•œ ë¡œë“œ (ê¸°ì¡´ ì„ íƒëœ ì„¸ë¶€ ê¶Œí•œ ê°’ì€ null)
                loadAndRenderAuthDetails(this.value, null); 
            });
        }
        
        // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        selectAll.addEventListener('change', (e) => {
            // ì „ì²´ ì²´í¬/ì²´í¬ í•´ì œ ë¡œì§
            const isChecked = e.target.checked;
            document.querySelectorAll('input[name="selectedUser"]').forEach(cb => {
                cb.checked = isChecked;
            });
            updateRetireButtonState();
        });

        document.addEventListener('change', (e) => {
             // ê°œë³„ ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì‹œ ì „ì²´ ì„ íƒ ìƒíƒœ ë° ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            if (e.target.name === 'selectedUser') {
                updateRetireButtonState();
                const allChecked = Array.from(document.querySelectorAll('input[name="selectedUser"]')).every(cb => cb.checked);
                selectAll.checked = allChecked;
            }
        });
        
        // 1. í¼ ì œì¶œ ì´ë²¤íŠ¸ í•¸ë“¤ë§ (ë“±ë¡/ìˆ˜ì •)
        userForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const isRegisterMode = registerBtns.classList.contains('hidden') === false;
            const url = isRegisterMode ? '/admin/insertUserInfo' : '/admin/updateUserInfoByAdmin';

            let formData = $(this).serializeArray().reduce((obj, item) => {
                obj[item.name] = item.value;
                return obj;
            }, {});
            
            // â­ï¸ ìˆ˜ì •ëœ ë¡œì§: userAuth ì™¸ë˜ í‚¤ ì˜¤ë¥˜ í•´ê²°ì„ ìœ„í•´ userAuthì— userDetailAuth ê°’ì„ í• ë‹¹í•©ë‹ˆë‹¤.
            // ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ìƒ user_auth í•„ë“œê°€ tb_sysauth_detailì˜ auth_detail_codeë¥¼ ì°¸ì¡°í•˜ëŠ” ê²ƒìœ¼ë¡œ ê°€ì •í•©ë‹ˆë‹¤.
            if (formData.userDetailAuth) {
                formData.userAuth = formData.userDetailAuth;
            } else if (formData.userAuth === '') {
                 // ë§Œì•½ ì„¸ë¶€ ê¶Œí•œì„ ì„ íƒí•˜ì§€ ì•Šì•˜ê³ , ì£¼ ê¶Œí•œë„ ì„ íƒí•˜ì§€ ì•Šì•˜ë‹¤ë©´,
                 // DBì—ì„œ user_authê°€ NOT NULL ì œì•½ ì¡°ê±´ì´ ê±¸ë ¤ìˆì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ì—¬ê¸°ì„œ ì²˜ë¦¬í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
            }
            // ----------------------------------------------------
            
            if (!isRegisterMode && formData.userPassword === '') {
                delete formData.userPassword;
            }

            if (isRegisterMode) {
                 delete formData.userNo;
            }

            $.ajax({
                url: url,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(formData),
                success: function(response) {
                    alert(response.message);
                    if (response.status === 'success') {
                        closeUserCrudModal(); 
                    }
                },
                error: function() {
                    alert(isRegisterMode ? 'ì‚¬ìš©ì ë“±ë¡ ì¤‘ ì„œë²„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' : 'ì‚¬ìš©ì ìˆ˜ì • ì¤‘ ì„œë²„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });
        });
        
        // 2. ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        searchBtn.addEventListener('click', function() {
             searchAndRenderUser(1);
        });

        // 3. ê³„ì • íì§€ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        retireBtn.addEventListener('click', () => {
            const selectedUserNos = Array.from(document.querySelectorAll('input[name="selectedUser"]:checked'))
                .map(cb => parseInt(cb.getAttribute('data-user-no'))); 

            if(selectedUserNos.length === 0) {
                alert("íì§€í•  ì‚¬ìš©ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
                return;
            }

            if(confirm(`ì„ íƒëœ ${selectedUserNos.length}ëª…ì˜ ì‚¬ìš©ìë¥¼ ì •ë§ ê³„ì • íì§€(ìƒíƒœ ë³€ê²½) ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                
                $.ajax({
                    url: '/admin/modifySysUserStatusRetire',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ userNoList: selectedUserNos }), 
                    success: function(response) {
                        alert(response.message);
                        if (response.status === 'success') {
                            searchAndRenderUser(currentPageNo); 
                        }
                    },
                    error: function() {
                        alert('ê³„ì • íì§€ ì²˜ë¦¬ ì¤‘ ì„œë²„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                });
            }
        });

        // ğŸŸ¢ ì´ˆê¸° ëª©ë¡ ìƒ‰ìƒ ì˜¤ë¥˜ í•´ê²°ì„ ìœ„í•œ AJAX ì¬ë Œë”ë§ ë¡œì§ ì¶”ê°€ ğŸŸ¢
        // í˜ì´ì§€ ë¡œë“œ ì‹œ AJAX í˜¸ì¶œì„ í•œ ë²ˆ ì‹¤í–‰í•˜ì—¬ renderUserTableì„ í†µí•´ ìƒ‰ìƒì„ ì •ìƒí™”í•©ë‹ˆë‹¤.
        // í˜„ì¬ í˜ì´ì§€ ìƒíƒœ(currentPageNo, currentSearchCondition)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ì‹œ ë¡œë“œ
        if (typeof searchAndRenderUser === 'function') {
            // ì„œë²„ í…œí”Œë¦¿ì˜ ì´ˆê¸° ë Œë”ë§ì„ ë®ì–´ì“°ê¸° ìœ„í•´ í˜¸ì¶œ
            searchAndRenderUser(currentPageNo); 
        }
    });
</script>
 
</body>
</html>