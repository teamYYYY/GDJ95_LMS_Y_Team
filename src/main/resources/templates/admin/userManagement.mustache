<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>시스템사용자관리 | 학사관리시스템</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #F5F7FA;
        }
        .admin-hero-bg {
            background-image: linear-gradient(to right, rgba(37, 99, 235, 0.9), rgba(30, 64, 175, 0.8)), url('https://images.unsplash.com/photo-1562774053-701939374585?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
        }
        .input-readonly {
            background-color: #F8F9FA;
            border-color: #E5E7EB;
            color: #6B7280;
            cursor: default;
        }
        .modal-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50; /* Tailwind z-50 */
        }
    </style>
</head>
<body class="text-gray-800">

    <header class="bg-white border-b border-gray-200">
        <div class="max-w-screen-2xl mx-auto py-3 px-6 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white">
                    <i class="fa-solid fa-graduation-cap text-lg"></i>
                </div>
                <h1 class="text-lg font-bold text-gray-800">학사관리시스템 <span class="text-sm font-medium text-gray-500 ml-1">관리자 페이지</span></h1>
            </div>
            <div class="text-sm text-gray-600 flex items-center gap-4">
                <p>홍길동님 로그인 중입니다</p> 
                <a href="/logout" class="text-red-500 hover:text-red-600 transition flex items-center gap-1">
                    <i class="fa-solid fa-right-from-bracket text-xs"></i> 로그아웃
                </a>
            </div>
        </div>
    </header>

    <div class="admin-hero-bg h-40 p-8 text-white">
        <div class="max-w-screen-2xl mx-auto h-full flex flex-col justify-end">
            <h2 class="text-3xl font-bold">관리자 대시보드</h2>
            <p class="text-sm text-gray-200 mt-2">시스템 관리 및 설정</p>
        </div>
    </div>

    <div class="flex min-h-[calc(100vh-16rem)]">
        
        <aside class="w-64 bg-white border-r border-gray-200 shadow-md flex-shrink-0">
            <nav class="p-4 space-y-1">
                <a href="/myInfo/userInfo" class="flex items-center gap-3 p-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                    <i class="fa-solid fa-user-gear w-5"></i> 개인정보관리
                </a>
                <a href="/admin/userManagement" class="flex items-center gap-3 p-3 rounded-lg bg-blue-50 text-blue-700 font-semibold transition">
                    <i class="fa-solid fa-users-gear w-5"></i> 시스템 사용자 관리
                    <i class="fa-solid fa-chevron-right ml-auto text-xs"></i>
                </a>
                <a href="#" class="flex items-center gap-3 p-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                    <i class="fa-solid fa-user-lock w-5"></i> 사용자권한관리
                </a>
                <a href="#" class="flex items-center gap-3 p-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                    <i class="fa-solid fa-book-open-reader w-5"></i> 학과관리
                </a>
                <a href="#" class="flex items-center gap-3 p-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                    <i class="fa-regular fa-bell w-5"></i> 공지사항관리
                </a>
            </nav>
        </aside>

        <main class="flex-grow p-8 max-w-screen-2xl mx-auto">
            <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-100">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">시스템 사용자 관리</h2>
                <p class="text-gray-500 mb-6">시스템 사용자를 조회하고 관리할 수 있습니다.</p>

                <div class="mb-8 p-4 border rounded-lg bg-gray-50">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">사용자 조회</h3>
                    <p class="text-sm text-gray-500 mb-3">사용자 ID, 이름, 이메일 등으로 검색할 수 있습니다.</p>
                    <div class="flex gap-2">
                        <input type="text" id="searchCondition" placeholder="사용자 ID 또는 이름을 입력하세요" class="flex-grow px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                        <button id="searchBtn" class="px-5 py-2.5 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition flex items-center gap-1">
                            <i class="fa-solid fa-magnifying-glass"></i> 조회
                        </button>
                    </div>
                </div>
                
                <div class="flex justify-between items-center mb-4">
                    <p class="text-gray-700 font-medium">사용자 목록 <span class="text-sm text-gray-500 ml-1">총 5명의 사용자</span></p>
                    <div class="flex gap-2">
                        <button class="px-3 py-1.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition flex items-center gap-1 text-sm">
                            <i class="fa-solid fa-download"></i> 목록 엑셀 다운로드
                        </button>
                        <button class="px-3 py-1.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition flex items-center gap-1 text-sm">
                            <i class="fa-solid fa-file-excel"></i> 양식 다운로드
                        </button>
                        <button onclick="openBatchUploadModal()" class="px-3 py-1.5 bg-green-500 text-white rounded-lg hover:bg-green-600 transition flex items-center gap-1 text-sm">
                            <i class="fa-solid fa-upload"></i> 일괄 업로드
                        </button>
                        <button onclick="openRegisterModal()" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-1 text-sm">
                            <i class="fa-solid fa-plus"></i> 등록
                        </button>
                    </div>
                </div>

                <div class="overflow-x-auto border rounded-lg">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="w-10 px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"><input type="checkbox" id="selectAll"></th>
                                <th class="w-10 px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">No.</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">학번 (ID)</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">이름</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">이메일</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">소속</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">권한</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">계정상태</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">등록일</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="userListBody">
                            <tr>
                                <td class="px-4 py-3 whitespace-nowrap text-center"><input type="checkbox" name="selectedUser" data-user-no="1"></td>
                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">1</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                                    <a href="#" onclick="openUserDetailModal('20240001')" class="text-blue-600 hover:underline">20240001</a>
                                </td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">김철수</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">kim@university.ac.kr</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">컴퓨터공학과</td>
                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-blue-600">학생</td>
                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-green-600">활성</td>
                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">2024-03-01</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 whitespace-nowrap text-center"><input type="checkbox" name="selectedUser" data-user-no="2"></td>
                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">2</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                                    <a href="#" onclick="openUserDetailModal('20240002')" class="text-blue-600 hover:underline">20240002</a>
                                </td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">이영희</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">lee@university.ac.kr</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">전자공학과</td>
                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-blue-600">학생</td>
                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-red-600">비활성</td>
                                <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500">2024-03-02</td>
                            </tr>
                             </tbody>
                    </table>
                </div>

                <div class="mt-4 flex justify-between items-center">
                    <button id="retireSelectedBtn" class="px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition disabled:bg-red-300" disabled>
                        <i class="fa-solid fa-user-slash mr-1"></i> 계정 폐지
                    </button>
                    <div class="flex items-center space-x-1" id="pagination">
                        <button class="px-3 py-1 border rounded-lg text-gray-500 hover:bg-gray-100">이전</button>
                        <button class="px-3 py-1 border rounded-lg bg-blue-600 text-white">1</button>
                        <button class="px-3 py-1 border rounded-lg text-gray-700 hover:bg-gray-100">2</button>
                        <button class="px-3 py-1 border rounded-lg text-gray-700 hover:bg-gray-100">3</button>
                        <button class="px-3 py-1 border rounded-lg text-gray-700 hover:bg-gray-100">4</button>
                        <button class="px-3 py-1 border rounded-lg text-gray-700 hover:bg-gray-100">5</button>
                        <button class="px-3 py-1 border rounded-lg text-gray-700 hover:bg-gray-100">6</button>
                        <button class="px-3 py-1 border rounded-lg text-gray-700 hover:bg-gray-100">7</button>
                        <button class="px-3 py-1 border rounded-lg text-gray-700 hover:bg-gray-100">8</button>
                        <button class="px-3 py-1 border rounded-lg text-gray-700 hover:bg-gray-100">9</button>
                        <button class="px-3 py-1 border rounded-lg text-gray-700 hover:bg-gray-100">10</button>
                        <button class="px-3 py-1 border rounded-lg text-gray-500 hover:bg-gray-100">다음</button>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <div id="batchUploadModal" class="modal-container hidden">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl p-6 relative">
            <button class="absolute top-4 right-4 text-gray-400 hover:text-gray-600" onclick="closeBatchUploadModal()">
                <i class="fa-solid fa-xmark"></i>
            </button>
            <h3 class="text-lg font-bold mb-4 border-b pb-2">사용자 일괄 업로드</h3>
            <p class="text-sm text-gray-500 mb-6">엑셀 파일을 업로드하여 여러 데이터를 한번에 등록할 수 있습니다.</p>
            
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-10 text-center mb-6">
                <i class="fa-solid fa-cloud-upload-alt text-5xl text-blue-400 mb-3"></i>
                <p class="text-gray-600">파일을 드래그하거나 클릭하여 업로드</p>
                <p class="text-xs text-gray-400">.xlsx, .xls 파일만 지원됩니다</p>
                <button class="mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                    파일 선택
                </button>
            </div>
            
            <div class="p-4 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 rounded-lg mb-6">
                <p class="font-semibold mb-2">⚠ 첨부파일 업로드 시 주의사항</p>
                <ul class="list-disc list-inside text-sm space-y-1">
                    <li>엑셀 파일 형식(.xlsx/.xls)만 업로드 가능합니다.</li>
                    <li>제공된 양식의 항목 및 순서를 변경하지 마세요.</li>
                    <li>필수 항목은 반드시 입력되어야 합니다.</li>
                    <li>최대 1000개까지 한번에 등록할 수 있습니다.</li>
                    <li>데이터 형식 불일치 오류 발생 시 등록이 실패할 수 있습니다.</li>
                    <li>등록된 데이터는 자동으로 **활성** 처리됩니다.</li>
                </ul>
            </div>
            
            <div class="pt-3 flex justify-end gap-3">
                <button type="button" onclick="closeBatchUploadModal()" class="px-5 py-2.5 border border-gray-300 text-gray-600 rounded-lg hover:bg-gray-50 transition">취소</button>
                <button type="button" class="px-5 py-2.5 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition">
                    <i class="fa-solid fa-upload mr-1"></i> 업로드
                </button>
            </div>
        </div>
    </div>

    <div id="userCrudModal" class="modal-container hidden">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl p-6 relative">
            <button class="absolute top-4 right-4 text-gray-400 hover:text-gray-600" onclick="closeUserCrudModal()">
                <i class="fa-solid fa-xmark"></i>
            </button>
            <h3 id="modalTitle" class="text-xl font-bold mb-4 border-b pb-2">사용자 등록</h3>
            <p id="modalSubtitle" class="text-sm text-gray-500 mb-4">* 표시는 필수 항목입니다</p>
            
            <form id="userForm" class="space-y-4">
                <input type="hidden" id="userNo" name="userNo" /> 

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="userId" class="block text-sm font-medium text-gray-700 mb-1">사용자 학번 *</label>
                        <input type="text" id="userId" name="userId" placeholder="학번을 입력하세요" required class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field" />
                    </div>
                    <div>
                        <label for="userName" class="block text-sm font-medium text-gray-700 mb-1">사용자 이름 *</label>
                        <input type="text" id="userName" name="userName" placeholder="이름을 입력하세요" required class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field" />
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label for="userAuth" class="block text-sm font-medium text-gray-700 mb-1">사용자 권한 *</label>
                        <select id="userAuth" name="userAuth" required class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
                            <option value="">권한을 선택하세요</option>
                            <option value="S">학생</option>
                            <option value="P">교수</option>
                            <option value="A">관리자</option>
                            <option value="G">일반직원</option>
                        </select>
                    </div>
                    <div>
                        <label for="userDetailAuth" class="block text-sm font-medium text-gray-700 mb-1">사용자 세부 권한 *</label>
                        <select id="userDetailAuth" name="userDetailAuth" required class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
                            <option value="">세부 권한을 선택하세요</option>
                            <option value="sub_admin">팀장</option>
                            <option value="staff">일반</option>
                            <option value="TA">조교</option>
                        </select>
                    </div>
                    <div>
                        <label for="userStatus" class="block text-sm font-medium text-gray-700 mb-1">사용자 계정 상태 *</label>
                        <select id="userStatus" name="userStatus" required class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
                            <option value="">상태를 선택하세요</option>
                            <option value="1">활성</option>
                            <option value="2">비활성</option>
                            <option value="3">폐지</option>
                            </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div id="passwordField">
                        <label for="userPassword" class="block text-sm font-medium text-gray-700 mb-1">사용자 비밀번호 *</label>
                        <input type="password" id="userPassword" name="userPassword" placeholder="비밀번호를 입력하세요 (수정 시 미입력 시 변경 없음)" required class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field" />
                    </div>
                    <div>
                        <label for="userEmail" class="block text-sm font-medium text-gray-700 mb-1">사용자 이메일</label>
                        <input type="email" id="userEmail" name="userEmail" placeholder="example@university.ac.kr" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field" />
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="userPhone" class="block text-sm font-medium text-gray-700 mb-1">사용자 연락처</label>
                        <input type="tel" id="userPhone" name="userPhone" placeholder="010-0000-0000" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field" />
                    </div>
                    <div>
                        <label for="userBirth" class="block text-sm font-medium text-gray-700 mb-1">사용자 생년월일</label>
                        <input type="date" id="userBirth" name="userBirth" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field" />
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label for="deptCode" class="block text-sm font-medium text-gray-700 mb-1">학과</label>
                        <select id="deptCode" name="deptCode" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
                            <option value="">학과를 선택하세요</option>
                             </select>
                    </div>
                    <div>
                        <label for="userGrade" class="block text-sm font-medium text-gray-700 mb-1">학년</label>
                        <select id="userGrade" name="userGrade" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field">
                            <option value="">학년을 선택하세요</option>
                             </select>
                    </div>
                    <div>
                        <label for="userPosition" class="block text-sm font-medium text-gray-700 mb-1">직급</label>
                        <input type="text" id="userPosition" name="userPosition" placeholder="직급을 입력하세요" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field" />
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="userZipcode" class="block text-sm font-medium text-gray-700 mb-1">우편번호</label>
                        <input type="text" id="userZipcode" name="userZipcode" placeholder="12345" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field" />
                    </div>
                    <div>
                        <label for="userAddr" class="block text-sm font-medium text-gray-700 mb-1">주소</label>
                        <input type="text" id="userAddr" name="userAddr" placeholder="주소를 입력하세요" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field" />
                    </div>
                </div>
                
                <div>
                    <label for="userAddrDetail" class="block text-sm font-medium text-gray-700 mb-1">상세 주소</label>
                    <input type="text" id="userAddrDetail" name="userAddrDetail" placeholder="상세 주소를 입력하세요" class="w-full px-4 py-2 border border-gray-300 rounded-lg input-field" />
                </div>

                <div id="registerButtons" class="pt-3 flex justify-end gap-3">
                    <button type="button" onclick="closeUserCrudModal()" class="px-5 py-2.5 border border-gray-300 text-gray-600 rounded-lg hover:bg-gray-50 transition">취소</button>
                    <button type="submit" class="px-5 py-2.5 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition">등록</button>
                </div>
                
                <div id="detailButtons" class="pt-3 flex justify-end gap-3 hidden">
                    <button type="button" onclick="enterDetailEditMode()" class="px-5 py-2.5 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition">변경</button>
                    <button type="button" onclick="closeUserCrudModal()" class="px-5 py-2.5 border border-gray-300 text-gray-600 rounded-lg hover:bg-gray-50 transition">닫기</button>
                </div>

                <div id="editButtons" class="pt-3 flex justify-end gap-3 hidden">
                    <button type="button" onclick="cancelDetailEditMode()" class="px-5 py-2.5 border border-gray-300 text-gray-600 rounded-lg hover:bg-gray-50 transition">취소</button>
                    <button type="submit" class="px-5 py-2.5 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition">수정</button>
                </div>
                
            </form>
        </div>
    </div>

    <script>
        const batchModal = document.getElementById('batchUploadModal');
        const userCrudModal = document.getElementById('userCrudModal');
        const userForm = document.getElementById('userForm');
        const modalTitle = document.getElementById('modalTitle');
        const modalSubtitle = document.getElementById('modalSubtitle');
        
        const registerBtns = document.getElementById('registerButtons');
        const detailBtns = document.getElementById('detailButtons');
        const editBtns = document.getElementById('editButtons');
        
        const passwordFieldDiv = document.getElementById('passwordField'); // 비밀번호 input을 감싸는 div
        const passwordInput = document.getElementById('userPassword');
        const userIdInput = document.getElementById('userId');
        
        // input-field 클래스를 가진 모든 입력/선택 필드 (숨김 필드 제외)
        const inputFields = document.querySelectorAll('#userCrudModal .input-field');
        
        // 상세 정보/수정 모드에서 읽기 전용 토글
        function toggleInputReadOnly(isReadOnly, isDetailMode) {
            inputFields.forEach(input => {
                // 비밀번호, ID, 권한, 상태 필드는 별도로 처리
                if (input.id === 'userPassword' || input.id === 'userId' || input.id === 'userStatus' || input.id === 'userAuth' || input.id === 'userDetailAuth') {
                    // continue; // 별도 처리
                }
                
                if (isReadOnly) {
                    input.setAttribute('readonly', true);
                    input.classList.add('input-readonly');
                    if (input.tagName === 'SELECT') {
                         input.style.pointerEvents = 'none'; // Select 요소도 비활성화
                    }
                } else {
                    input.removeAttribute('readonly');
                    input.classList.remove('input-readonly');
                    if (input.tagName === 'SELECT') {
                        input.style.pointerEvents = 'auto';
                    }
                }
            });
            
            // 등록/상세/수정 모드에 따른 비밀번호, ID 필드 처리
            if (isDetailMode) {
                 // 상세 보기에서는 ID는 항상 읽기 전용
                 userIdInput.setAttribute('readonly', true);
                 userIdInput.classList.add('input-readonly');
            } else {
                 // 등록 모드에서는 ID 편집 가능
                 userIdInput.removeAttribute('readonly');
                 userIdInput.classList.remove('input-readonly');
            }
            
             // 비밀번호 필드는 이제 항상 표시됨.
             passwordFieldDiv.style.display = 'block'; 
             passwordInput.placeholder = isReadOnly ? '***' : '비밀번호를 입력하세요 (수정 시 미입력 시 변경 없음)';
             passwordInput.required = !isReadOnly && !isDetailMode; // 등록 시에만 필수
             passwordInput.disabled = isReadOnly; // 상세 보기 모드에서는 비활성화
             passwordInput.value = ''; // 필드 보안을 위해 값 비움
             if (isReadOnly) {
                 // 상세 보기 모드에서 권한, 상태 필드도 읽기 전용 스타일 적용
                document.getElementById('userAuth').style.pointerEvents = 'none';
                document.getElementById('userDetailAuth').style.pointerEvents = 'none';
                document.getElementById('userStatus').style.pointerEvents = 'none';
                document.getElementById('userAuth').classList.add('input-readonly');
                document.getElementById('userDetailAuth').classList.add('input-readonly');
                document.getElementById('userStatus').classList.add('input-readonly');
             } else {
                 // 수정/등록 모드에서 권한, 상태 필드 읽기 전용 스타일 해제
                document.getElementById('userAuth').style.pointerEvents = 'auto';
                document.getElementById('userDetailAuth').style.pointerEvents = 'auto';
                document.getElementById('userStatus').style.pointerEvents = 'auto';
                document.getElementById('userAuth').classList.remove('input-readonly');
                document.getElementById('userDetailAuth').classList.remove('input-readonly');
                document.getElementById('userStatus').classList.remove('input-readonly');
             }
        }
        
        // ------------------------
        // 일괄 업로드 모달
        // ------------------------
        function openBatchUploadModal() {
            batchModal.classList.remove('hidden');
            batchModal.classList.add('flex');
        }

        function closeBatchUploadModal() {
            batchModal.classList.add('hidden');
            batchModal.classList.remove('flex');
        }
        
        // ------------------------
        // 사용자 등록/상세/수정 모달
        // ------------------------
        function closeUserCrudModal() {
            userCrudModal.classList.add('hidden');
            userCrudModal.classList.remove('flex');
            // 폼 초기화 및 상태 복구
            userForm.reset();
            // ID 읽기 전용 해제 (다음 등록을 위해)
            userIdInput.removeAttribute('readonly');
            userIdInput.classList.remove('input-readonly');
        }

        function openRegisterModal() {
            modalTitle.textContent = "사용자 등록";
            modalSubtitle.textContent = "* 표시는 필수 항목입니다";
            
            // 모든 필드 편집 가능. 비밀번호 필수.
            toggleInputReadOnly(false, false); 
            
            registerBtns.classList.remove('hidden');
            detailBtns.classList.add('hidden');
            editBtns.classList.add('hidden');
            
            passwordInput.required = true; // 등록 시에는 비밀번호 필수
            userIdInput.removeAttribute('readonly'); // ID 편집 가능
            
            userCrudModal.classList.remove('hidden');
            userCrudModal.classList.add('flex');
        }

        function openUserDetailModal(userId) {
            modalTitle.textContent = "사용자 상세 정보 (" + userId + ")";
            modalSubtitle.textContent = "사용자 정보를 조회합니다. (변경 버튼을 눌러 수정 가능)";
            
            // 🚨 가상의 데이터 로딩 (실제 구현 시 AJAX 호출로 대체)
            // loadUserData(userId); 
            
            // 상세 정보 모드는 읽기 전용, 비밀번호 필드는 보이지만 비활성화.
            toggleInputReadOnly(true, true); 
            
            detailBtns.classList.remove('hidden');
            registerBtns.classList.add('hidden');
            editBtns.classList.add('hidden');
            
            // 비밀번호는 상세 보기 시 필수 아님
            passwordInput.required = false; 
            passwordInput.setAttribute('type', 'text'); // 상세에서는 숨김 없이 **표시
            passwordInput.value = '********'; // 임시로 마스킹 처리
            passwordInput.setAttribute('readonly', true); // 비밀번호 필드도 읽기 전용
            passwordInput.classList.add('input-readonly');


            userCrudModal.classList.remove('hidden');
            userCrudModal.classList.add('flex');
        }

        // 상세 정보 -> 변경 (편집 모드 진입)
        function enterDetailEditMode() {
            modalTitle.textContent = "사용자 정보 수정";
            modalSubtitle.textContent = "정보를 수정 후 저장해주세요.";
            
            // 비밀번호와 ID를 제외한 필드 편집 가능.
            toggleInputReadOnly(false, true); 
            
            editBtns.classList.remove('hidden');
            detailBtns.classList.add('hidden');
            registerBtns.classList.add('hidden');
            
            // ID는 수정 시에도 변경 불가
            userIdInput.setAttribute('readonly', true);
            userIdInput.classList.add('input-readonly');
            
            // 비밀번호는 수정 시 다시 보이게 하고 필수는 아니게 설정 (변경을 원하면 입력)
            passwordInput.setAttribute('type', 'password'); // 다시 password 타입으로
            passwordInput.removeAttribute('readonly');
            passwordInput.classList.remove('input-readonly');
            passwordInput.disabled = false;
            passwordInput.required = false; 
            passwordInput.value = ''; // 수정 모드 진입 시 기존 비밀번호는 비움
        }

        // 편집 모드 -> 취소 (상세 정보 보기 모드로 복귀)
        function cancelDetailEditMode() {
            // 🚨 실제로는 여기서 로드된 원본 데이터를 다시 폼에 채워야 합니다.
            // 현재는 임시로 상세 모드로 다시 전환
            // openUserDetailModal(document.getElementById('userId').value); 
            
            // 임시로 그냥 상세 모드로 전환 (데이터 복구 로직 필요)
            modalTitle.textContent = "사용자 상세 정보 (" + userIdInput.value + ")";
            modalSubtitle.textContent = "사용자 정보를 조회합니다. (변경 버튼을 눌러 수정 가능)";
            
            toggleInputReadOnly(true, true); 
            
            detailBtns.classList.remove('hidden');
            editBtns.classList.add('hidden');
        }

        // 키보드 ESC로 모달 닫기
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeBatchUploadModal();
                closeUserCrudModal();
            }
        });
        
        // 체크박스 전체 선택/해제 및 폐지 버튼 활성화
        document.addEventListener('DOMContentLoaded', () => {
            const selectAll = document.getElementById('selectAll');
            const userCheckboxes = document.querySelectorAll('input[name="selectedUser"]');
            // ID 변경: deleteSelectedBtn -> retireSelectedBtn
            const retireBtn = document.getElementById('retireSelectedBtn'); 

            selectAll.addEventListener('change', (e) => {
                userCheckboxes.forEach(checkbox => checkbox.checked = e.target.checked);
                updateRetireButtonState();
            });

            userCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateRetireButtonState);
            });

            function updateRetireButtonState() {
                const checkedCount = document.querySelectorAll('input[name="selectedUser"]:checked').length;
                retireBtn.disabled = checkedCount === 0;
            }
            
            // 🚨 계정 폐지 버튼 클릭 이벤트 (예시)
            retireBtn.addEventListener('click', () => {
                if(confirm("선택된 사용자를 정말 계정 폐지(상태 변경) 처리하시겠습니까?")) {
                    const selectedUserNos = Array.from(document.querySelectorAll('input[name="selectedUser"]:checked'))
                        .map(cb => cb.getAttribute('data-user-no')); // user_no를 가져오도록 수정

                    alert("다음 사용자 No가 계정 폐지 처리되었습니다: " + selectedUserNos.join(', '));
                    // 실제 AJAX 호출로 폐지 로직 구현 필요 (modifySysUserStatusRetire)
                    selectAll.checked = false;
                    updateRetireButtonState(); 
                }
            });
            
            // 폼 제출 이벤트 핸들링 (등록/수정)
            userForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const formMode = editBtns.classList.contains('hidden') ? '등록' : '수정';
                alert(formMode + " 요청: 실제로는 AJAX를 통해 서버로 데이터를 전송해야 합니다.");
                closeUserCrudModal();
            });
        });
    </script>
 
</body>
</html>