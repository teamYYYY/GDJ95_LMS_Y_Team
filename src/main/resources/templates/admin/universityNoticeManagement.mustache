<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ìš©ì ê¶Œí•œ ê´€ë¦¬ | í•™ì‚¬ê´€ë¦¬ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #F5F7FA;
        }
        .admin-hero-bg {
            background-image: linear-gradient(to right, rgba(37, 99, 235, 0.9), rgba(30, 64, 175, 0.8)), url('https://images.unsplash.com/photo-1562774053-701939374585?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
        }
        .input-readonly {
            background-color: #F8F9FA;
            border-color: #E5E7EB;
            color: #6B7280;
            cursor: default;
        }
        .modal-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
    </style>
</head>
<body class="text-gray-800">

<!-- í—¤ë”ë¶€ë¶„ -->

 <header class="bg-white border-b border-gray-200">
    <div class="max-w-screen-2xl mx-auto py-3 px-6 flex items-center justify-between">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white">
                <i class="fa-solid fa-graduation-cap text-lg"></i>
            </div>
            <h1 class="text-lg font-bold text-gray-800">
                <a href="/main" class="text-gray-800 hover:text-blue-600 transition">
                    í•™ì‚¬ê´€ë¦¬ì‹œìŠ¤í…œ
                </a>
                <span class="text-sm font-medium text-gray-500 ml-1">ê´€ë¦¬ì í˜ì´ì§€</span>
            </h1>
        </div>
        <div class="text-sm text-gray-600 flex items-center gap-4">
            <p>í™ê¸¸ë™ë‹˜ ë¡œê·¸ì¸ ì¤‘ì…ë‹ˆë‹¤</p>
            <a href="/logout" class="text-red-500 hover:text-red-600 transition flex items-center gap-1">
                <i class="fa-solid fa-right-from-bracket text-xs"></i> ë¡œê·¸ì•„ì›ƒ
            </a>
        </div>
    </div>
	</header>

    <div class="admin-hero-bg h-40 p-8 text-white">
        <div class="max-w-screen-2xl mx-auto h-full flex flex-col justify-end">
            <h2 class="text-3xl font-bold">ê³µì§€ì‚¬í•­ ê´€ë¦¬</h2>
            <p class="text-sm text-gray-200 mt-2">í•™êµ ê³µì§€ì‚¬í•­ ì¡°íšŒ ë° ê´€ë¦¬</p>
        </div>
    </div>

    <div class="flex min-h-[calc(100vh-16rem)]">

        <aside class="w-64 bg-white border-r border-gray-200 shadow-md flex-shrink-0">
            <nav class="p-4 space-y-1">
                <a href="/myInfo/userInfo" class="flex items-center gap-3 p-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                    <i class="fa-solid fa-user-gear w-5"></i> ê°œì¸ì •ë³´ ê´€ë¦¬
                </a>
                <a href="/admin/userManagement" class="flex items-center gap-3 p-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                    <i class="fa-solid fa-users-gear w-5"></i> ì‹œìŠ¤í…œ ì‚¬ìš©ì ê´€ë¦¬
                </a>
                <a href="/admin/sysAuthManagement" class="flex items-center gap-3 p-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                    <i class="fa-solid fa-user-lock w-5"></i> ì‚¬ìš©ì ê¶Œí•œ ê´€ë¦¬
                </a>
                <a href="/admin/deptManagement" class="flex items-center gap-3 p-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                    <i class="fa-solid fa-book-open-reader w-5"></i> í•™ê³¼ ê´€ë¦¬
                </a>
                <a href="/admin/universityNoticeManagement" class="flex items-center gap-3 p-3 rounded-lg bg-blue-50 text-blue-700 font-semibold transition">
                    <i class="fa-regular fa-bell w-5"></i> ê³µì§€ì‚¬í•­ ê´€ë¦¬
                    <i class="fa-solid fa-chevron-right ml-auto text-xs"></i>
                </a>
                <a href="/admin/courseManagement" class="flex items-center gap-3 p-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
            		<i class="fa-solid fa-graduation-cap w-5"></i> í•™ì  ê´€ë¦¬
        		</a>
            </nav>
        </aside>

	<!-- ë©”ì¸ ë™ì  ë¶€ë¶„ -->
<main class="flex-grow p-8 max-w-screen-2xl mx-auto">
    <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-100">

        <h2 class="text-2xl font-bold text-gray-800 mb-2">ğŸ“¢ í•™êµ ê³µì§€ì‚¬í•­ ê´€ë¦¬</h2>
        <p class="text-gray-500 mb-6">í•™êµ ê³µì§€ì‚¬í•­ì„ ë“±ë¡, ìˆ˜ì •, ì¡°íšŒ ë° ì‚­ì œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

        <form id="searchForm" class="mb-8 p-4 border rounded-lg bg-gray-50">
            <h3 class="text-lg font-semibold text-gray-700 mb-2">ê³µì§€ì‚¬í•­ ê²€ìƒ‰</h3>
            <p class="text-sm text-gray-500 mb-3">ì œëª© ë˜ëŠ” ë‚´ìš©ìœ¼ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <div class="flex items-center gap-2">
                <div class="flex-grow">
                    <input type="text"
                           id="searchUniversityNoticeCondition"
                           name="searchUniversityNoticeCondition"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                           placeholder="ì œëª© ë˜ëŠ” ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"
                           value="{{searchUniversityNoticeCondition}}">
                </div>
                <button type="submit" id="searchBtn" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-1 text-sm">
                    <i class="fa-solid fa-magnifying-glass"></i> ì¡°íšŒ
                </button>
            </div>
        </form>

        <div class="flex justify-between items-center mb-4">
            <p class="text-gray-700 font-medium" id="totalCountDisplay">ê³µì§€ ëª©ë¡ (ì´ {{totalCount}}ê°œì˜ ê³µì§€)</p>
            <div class="flex space-x-2">
                <button id="removeSelectedBtn" disabled class="px-3 py-1.5 bg-red-600 text-white rounded-lg hover:bg-red-700 transition disabled:opacity-50 disabled:cursor-not-allowed text-sm">
                    <i class="fa-solid fa-trash-can mr-1"></i> ì„ íƒ ì‚­ì œ
                </button>
                <button id="openRegisterModalBtn" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-1 text-sm">
                    <i class="fa-solid fa-plus"></i> ê³µì§€ ë“±ë¡
                </button>
            </div>
        </div>

        <div class="overflow-x-auto border border-gray-200 rounded-lg">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="p-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-10"><input type="checkbox" id="selectAll"></th>
                        <th class="p-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-16">No</th>
                        <th class="p-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-28">ìš°ì„ ìˆœìœ„</th>
                        <th class="p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì œëª©</th>
                        <th class="p-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-24">ì‘ì„±ì</th>
                        <th class="p-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-24">ì¡°íšŒìˆ˜</th>
                        <th class="p-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-32">ì—…ë°ì´íŠ¸ì¼ì</th>
                        <th class="p-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-32">ìƒì„±ì¼ì</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="noticeListBody">
                    {{#universityNoticeList}}
                    <tr class="hover:bg-gray-50">
                        <td class="p-3 whitespace-nowrap text-center"><input type="checkbox" name="noticeNo" value="{{universityNoticeNo}}" class="notice-checkbox"></td>
                        <td class="p-3 whitespace-nowrap text-center text-sm text-gray-500">{{universityNoticeNo}}</td>
                        <td class="p-3 whitespace-nowrap text-xs text-center">
                            <span class="font-medium {{priorityColorClass}}">
                                {{universityNoticePriorityName}}
                            </span>
                        </td>
                        <td class="p-3 text-sm text-gray-900 cursor-pointer hover:text-blue-600 font-medium detail-link" data-notice-no="{{universityNoticeNo}}">
                            {{universityNoticeTitle}}
                        </td>
                        <td class="p-3 whitespace-nowrap text-center text-sm text-gray-800">{{universityWriterUserName}}</td>
                        <td class="p-3 whitespace-nowrap text-center text-sm text-gray-500">{{universityNoticeViewCnt}}</td>
                        <td class="p-3 whitespace-nowrap text-center text-sm text-gray-500">{{universityNoticeUpdatedate}}</td>
                        <td class="p-3 whitespace-nowrap text-center text-sm text-gray-500">{{universityNoticeCreatedate}}</td>
                    </tr>
                    {{/universityNoticeList}}
                    {{^universityNoticeList}}
                    <tr>
                        <td colspan="8" class="p-4 text-center text-gray-500 text-sm">ì¡°íšŒëœ ê³µì§€ì‚¬í•­ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                    </tr>
                    {{/universityNoticeList}}
                </tbody>
            </table>
        </div>

        <div class="flex justify-center items-center mt-6" id="pagination">
             </div>
    </div>
</main>

</div>

	<!-- CRUD Modal ë¶€ë¶„ -->

	<div id="noticeCrudModal" class="modal-container fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="bg-white w-full max-w-lg rounded-xl shadow-2xl transform transition-all duration-300 scale-100">
            <div class="p-6">
                <div class="flex justify-between items-center pb-4 border-b">
                    <h3 id="modalTitle" class="text-xl font-bold text-gray-900">ê³µì§€ì‚¬í•­ ë“±ë¡</h3>
                    <button onclick="closeNoticeModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fa-solid fa-xmark text-2xl"></i>
                    </button>
                </div>

                <form id="noticeForm" class="mt-6 space-y-4">
                    <p id="modalSubtitle" class="text-sm text-red-500">* í‘œì‹œëŠ” í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤</p>

                    <div>
                        <label for="universityNoticeNo" class="block text-sm font-medium text-gray-700">ê³µì§€ ë²ˆí˜¸</label>
                        <input type="text" id="universityNoticeNo" name="universityNoticeNo" class="input-field mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed" readonly>
                    </div>

                    <div>
                        <label for="universityWriterUserName" class="block text-sm font-medium text-gray-700">ì‘ì„±ì</label>
                        <input type="text" id="universityWriterUserName" name="universityWriterUserName" class="input-field mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed" readonly>
                    </div>

                    <div>
                        <label for="universityNoticeViewCnt" class="block text-sm font-medium text-gray-700">ì¡°íšŒìˆ˜</label>
                        <input type="text" id="universityNoticeViewCnt" name="universityNoticeViewCnt" class="input-field mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed" readonly>
                    </div>

                    <div>
                        <label for="universityNoticeTitle" class="block text-sm font-medium text-gray-700">ì œëª© *</label>
                        <input type="text" id="universityNoticeTitle" name="universityNoticeTitle" class="input-field mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="ê³µì§€ì‚¬í•­ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                    </div>

                    <div>
                        <label for="universityNoticePriorityCode" class="block text-sm font-medium text-gray-700">ìš°ì„ ìˆœìœ„ *</label>
                        <select id="universityNoticePriorityCode" name="universityNoticePriorityCode" class="input-field mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" required>
                            <option value="">ìš°ì„ ìˆœìœ„ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            {{#universityNoticePriorityList}}
                            <option value="{{universityNoticePriorityCode}}">{{universityNoticePriorityName}}</option>
                            {{/universityNoticePriorityList}}
                        </select>
                    </div>

                    <div>
                        <label for="universityNoticeContent" class="block text-sm font-medium text-gray-700">ë‚´ìš© *</label>
                        <textarea id="universityNoticeContent" name="universityNoticeContent" rows="5" class="input-field mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="ê³µì§€ì‚¬í•­ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
                    </div>

                    <div class="pt-6 border-t mt-6 flex justify-end space-x-3">
                        <div id="registerButtons" class="flex space-x-3">
                            <button type="button" onclick="closeNoticeModal()" class="px-3 py-1.5 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition text-sm">
                                <i class="fa-solid fa-times mr-1"></i> ì·¨ì†Œ
                            </button>
                            <button type="submit" data-action="register" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm">
                                <i class="fa-solid fa-floppy-disk mr-1"></i> ë“±ë¡
                            </button>
                        </div>

                        <div id="detailButtons" class="hidden flex space-x-3">
                            <button type="button" onclick="closeNoticeModal()" class="px-3 py-1.5 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition text-sm">
                                <i class="fa-solid fa-times mr-1"></i> ë‹«ê¸°
                            </button>
                            <button type="button" onclick="enterDetailEditMode()" class="px-3 py-1.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition text-sm">
                                <i class="fa-solid fa-pen-to-square mr-1"></i> ë³€ê²½
                            </button>
                        </div>

                        <div id="editButtons" class="hidden flex space-x-3">
                            <button type="button" onclick="cancelDetailEditMode()" class="px-3 py-1.5 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition text-sm">
                                <i class="fa-solid fa-xmark mr-1"></i> ì·¨ì†Œ
                            </button>
                            <button type="submit" data-action="update" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm">
                                <i class="fa-solid fa-floppy-disk mr-1"></i> ì €ì¥
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>



	<!-- ì—‘ì…€ ê¸°ëŠ¥ -->

    <div id="batchUploadModal" class="modal-container hidden">
        <div class="bg-white w-full max-w-lg rounded-xl shadow-2xl transform transition-all duration-300 scale-100">
            <div class="p-6">
                <div class="flex justify-between items-center pb-4 border-b">
                    <h3 class="text-2xl font-bold text-gray-900">ê¶Œí•œ ì¼ê´„ ì—…ë¡œë“œ</h3>
                    <button onclick="closeBatchUploadModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fa-solid fa-xmark text-2xl"></i>
                    </button>
                </div>

                <div class="mt-6 text-center space-y-4">
                    <p class="text-gray-600">ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ì—¬ëŸ¬ ë°ì´í„°ë¥¼ í•œë²ˆì— ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    <div class="border-2 border-dashed border-gray-300 p-10 rounded-lg text-gray-500">
                        <i class="fa-solid fa-cloud-upload-alt text-4xl mb-3"></i>
                        <p>íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</p>
                        <p class="text-sm">.xlsx, .xls íŒŒì¼ë§Œ ì§€ì›ë©ë‹ˆë‹¤</p>
                        <button class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition">
                            íŒŒì¼ ì„ íƒ
                        </button>
                    </div>

                    <div class="text-left bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-md text-sm text-yellow-800">
                        <p class="font-semibold mb-2 flex items-center"><i class="fa-solid fa-circle-exclamation mr-2"></i> ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œ ì‹œ ì£¼ì˜ì‚¬í•­</p>
                        <ul class="list-disc list-inside space-y-1">
                            <li>ì—‘ì…€ íŒŒì¼ í˜•ì‹(.xlsx, .xls)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
                            <li>ì œê³µëœ ì–‘ì‹ì˜ í•­ëª©ê³¼ ìˆœì„œë¥¼ ë³€ê²½í•˜ì§€ ë§ˆì„¸ìš”.</li>
                            <li>í•„ìˆ˜ í•­ëª©ì€ ë°˜ë“œì‹œ ì…ë ¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</li>
                            <li>ìµœëŒ€ 1000ê°œì˜ ë°ì´í„°ê¹Œì§€ í•œë²ˆì— ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                            <li>ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•Šìœ¼ë©´ ë“±ë¡ì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                            <li>ì¤‘ë³µëœ ë°ì´í„°ëŠ” ìë™ìœ¼ë¡œ ì œì™¸ë©ë‹ˆë‹¤.</li>
                        </ul>
                    </div>
                </div>

                <div class="pt-6 border-t mt-6 flex justify-end space-x-3">
                    <button type="button" onclick="closeBatchUploadModal()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition">ì·¨ì†Œ</button>
                    <button type="button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition">ì—…ë¡œë“œ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ìŠ¤í¬ë¦½íŠ¸ ë¶€ë¶„ -->

<script>
    $(document).ready(function() {

        // ==========================================================
        // 0. ì „ì—­ ìƒíƒœ ë° ëª¨ë‹¬ ì œì–´ í•¨ìˆ˜ (HTML onclick ì œê±° í›„ì—ë„ ìœ ì§€)
        // ==========================================================
        let currentMode = 'register';
        let originalDetailData = {};
        
        // Mustacheë¡œ ì„œë²„ì—ì„œ ë°›ì€ ì´ˆê¸°ê°’ ì„¤ì •
        const initialTotalCount = parseInt('{{totalCount}}');
        const initialCurrentPage = parseInt('{{currentPage}}');
        const initialSearchCondition = '{{searchUniversityNoticeCondition}}' || '';

        /**
         * ê³µì§€ì‚¬í•­ ëª¨ë‹¬ì„ ì—´ê³  ëª¨ë“œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
         * @param {string} mode - 'register', 'detail' ì¤‘ í•˜ë‚˜
         * @param {number | null} noticeNo - ìƒì„¸/ìˆ˜ì • ì‹œ ê³µì§€ ë²ˆí˜¸
         */
        window.openNoticeModal = function(mode, noticeNo) {
            currentMode = mode;
            const $modal = $('#noticeCrudModal');
            const $form = $('#noticeForm');

            // í¼ ì´ˆê¸°í™”
            $form[0].reset();
            // .input-field í´ë˜ìŠ¤ë¥¼ ê°€ì§„ ìš”ì†Œë“¤ì˜ ìƒíƒœ ì´ˆê¸°í™”
            $form.find('.input-field').prop('readonly', false).prop('disabled', false).removeClass('bg-gray-100 cursor-not-allowed');

            // ID, ì‘ì„±ì, ì¡°íšŒìˆ˜ í•„ë“œëŠ” í•­ìƒ readonly ìœ ì§€
            $('#universityNoticeNo').prop('readonly', true).addClass('bg-gray-100 cursor-not-allowed').val('');
            $('#universityWriterUserName').prop('readonly', true).addClass('bg-gray-100 cursor-not-allowed').val('');
            $('#universityNoticeViewCnt').prop('readonly', true).addClass('bg-gray-100 cursor-not-allowed').val('');

            // ë²„íŠ¼ ë° ì œëª© ì„¤ì •
            $('#registerButtons').addClass('hidden');
            $('#detailButtons').addClass('hidden');
            $('#editButtons').addClass('hidden');

            if (mode === 'register') {
                $('#modalTitle').text('ê³µì§€ì‚¬í•­ ë“±ë¡');
                $('#registerButtons').removeClass('hidden');
                $('#universityWriterUserName').val('ì‘ì„±ì ìë™ ì„¤ì •');
                $('#universityNoticeNo').parent().hide(); 
                $('#universityNoticeViewCnt').parent().hide(); 
            } else if (mode === 'detail') {
                $('#modalTitle').text('ê³µì§€ì‚¬í•­ ìƒì„¸ ì¡°íšŒ');
                $('#universityNoticeNo').parent().show(); 
                $('#universityNoticeViewCnt').parent().show(); 
                loadNoticeDetail(noticeNo);
            }

            $modal.removeClass('hidden');
        };

        window.closeNoticeModal = function() {
            $('#noticeCrudModal').addClass('hidden');
            originalDetailData = {};
        };

        window.enterDetailEditMode = function() {
            currentMode = 'edit';
            $('#modalTitle').text('ê³µì§€ì‚¬í•­ ìˆ˜ì •');
            $('#detailButtons').addClass('hidden');
            $('#editButtons').removeClass('hidden');

            // ìˆ˜ì • ê°€ëŠ¥ í•„ë“œ í™œì„±í™” (ì œëª©, ë‚´ìš©, ìš°ì„ ìˆœìœ„)
            $('#universityNoticeTitle').prop('readonly', false).removeClass('bg-gray-100 cursor-not-allowed');
            $('#universityNoticeContent').prop('readonly', false).removeClass('bg-gray-100 cursor-not-allowed');
            $('#universityNoticePriorityCode').prop('disabled', false).removeClass('bg-gray-100 cursor-not-allowed');
        };

        window.cancelDetailEditMode = function() {
            // ìƒì„¸ ì¡°íšŒ ëª¨ë“œë¡œ ë³µê·€ ë° ì›ë˜ ë°ì´í„° ë³µì›
            currentMode = 'detail';
            $('#modalTitle').text('ê³µì§€ì‚¬í•­ ìƒì„¸ ì¡°íšŒ');
            $('#editButtons').addClass('hidden');
            $('#detailButtons').removeClass('hidden');

            // ë°ì´í„° ë³µì› ë° ì½ê¸° ì „ìš©ìœ¼ë¡œ ì„¤ì •
            bindDetailData(originalDetailData, false);
        };


        // ==========================================================
        // 1. ê³µì§€ì‚¬í•­ ëª©ë¡ ë¡œë”© ë° ê²€ìƒ‰/í˜ì´ì§• ê¸°ëŠ¥ (í•µì‹¬ ê°±ì‹  ë¡œì§)
        // ==========================================================

        /**
         * ëª©ë¡ì„ AJAXë¡œ ë‹¤ì‹œ ë¶ˆëŸ¬ì™€ í…Œì´ë¸”ê³¼ í˜ì´ì§•ì„ ê°±ì‹ í•©ë‹ˆë‹¤.
         * @param {number} pageNo - ìš”ì²­í•  í˜ì´ì§€ ë²ˆí˜¸ (ê¸°ë³¸ 1)
         * @param {string} searchCondition - ê²€ìƒ‰ ì¡°ê±´ (ê¸°ë³¸ ë¹ˆ ë¬¸ìì—´)
         */
        window.loadNoticeList = function(pageNo, searchCondition) {
            const condition = searchCondition || $('#searchUniversityNoticeCondition').val() || '';
            const currentPage = pageNo || 1;

            $.ajax({
                url: '/admin/searchUniversityNotice', // Controllerì˜ 5ë²ˆ ë§¤í•‘ ì‚¬ìš©
                type: 'GET',
                data: {
                    searchUniversityNoticeCondition: condition,
                    currentPage: currentPage
                },
                success: function(response) {
                    if (response.status === 'success') {
                        const list = response.searchUniversityNoticeInfoList;
                        const totalCount = response.totalCount;
                        const totalPages = Math.ceil(totalCount / 10); // Controller limit=10 ê¸°ì¤€

                        // 1. í…Œì´ë¸” ì—…ë°ì´íŠ¸
                        updateNoticeTable(list);

                        // 2. ì´ ê°œìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
                        $('#totalCountDisplay').text(`ê³µì§€ ëª©ë¡ (ì´ ${totalCount}ê°œì˜ ê³µì§€)`);

                        // 3. í˜ì´ì§• ì—…ë°ì´íŠ¸
                        updatePagination(currentPage, totalPages, condition);

                        // 4. ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì´ˆê¸°í™”
                        $('#selectAll').prop('checked', false);
                        updateDeleteButtonState(); // ëª©ë¡ ê°±ì‹  í›„ ì‚­ì œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                    } else {
                        alert('ëª©ë¡ ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                },
                error: function(xhr) {
                    console.error('List load AJAX Error:', xhr);
                    alert('ëª©ë¡ ë¡œë“œ ì¤‘ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });
        };

        /**
         * ì¡°íšŒëœ ëª©ë¡ ë°ì´í„°ë¥¼ HTML í…Œì´ë¸”ì— ë°”ì¸ë”©í•©ë‹ˆë‹¤.
         */
        function updateNoticeTable(list) {
            const $tbody = $('#noticeListBody');
            $tbody.empty(); 

            if (list && list.length > 0) {
                list.forEach(function(item) {
                    
                    // â­ï¸ ìˆ˜ì •ëœ ë¶€ë¶„: DTOì—ì„œ ë°›ì€ priorityCode (10 ë˜ëŠ” 20)ì— ë§ê²Œ í´ë˜ìŠ¤ ì¬ì •ì˜ â­ï¸
                    let finalBadgeClass = 'bg-gray-100 text-gray-800'; // ê¸°ë³¸ê°’ (30 ë˜ëŠ” ê¸°íƒ€)
                    const priorityCode = item.universityNoticePriorityCode; // MyBatis XMLì—ì„œ ê°€ì ¸ì˜¨ ì½”ë“œ

                    // Service/DBì˜ ìš°ì„ ìˆœìœ„ ì½”ë“œ(10, 20)ì— ë§ê²Œ í´ë˜ìŠ¤ ì ìš©
                    if (priorityCode === 10) {
                        finalBadgeClass = 'bg-red-100 text-red-700'; // í•„ìˆ˜/ê¸´ê¸‰ ê³µì§€ (Serviceì˜ 10:text-red-600 ëŒ€ì‘)
                    } else if (priorityCode === 20) {
                        finalBadgeClass = 'bg-yellow-100 text-orange-700'; // ì£¼ìš”/ì¤‘ìš” ê³µì§€ (Serviceì˜ 20:text-orange-500 ëŒ€ì‘)
                    }
                    // â­ï¸ ìˆ˜ì •ëœ ë¶€ë¶„ ë â­ï¸

                    // HTML onclick ëŒ€ì‹  data-attributeì™€ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©
                    const row = `
                        <tr class="hover:bg-gray-50">
                            <td class="p-3 whitespace-nowrap text-center"><input type="checkbox" name="noticeNo" value="${item.universityNoticeNo}" class="notice-checkbox"></td>
                            <td class="p-3 whitespace-nowrap text-center text-sm text-gray-500">${item.universityNoticeNo}</td>
                            <td class="p-3 whitespace-nowrap text-xs text-center">
                                <span class="font-medium ${finalBadgeClass} px-2 py-0.5 rounded-full">
                                    ${item.universityNoticePriorityName}
                                </span>
                            </td>
                            <td class="p-3 text-sm text-gray-900 cursor-pointer hover:text-blue-600 font-medium detail-link" data-notice-no="${item.universityNoticeNo}">
                                ${item.universityNoticeTitle}
                            </td>
                            <td class="p-3 whitespace-nowrap text-center text-sm text-gray-800">${item.universityWriterUserName || 'ì•Œ ìˆ˜ ì—†ìŒ'}</td>
                            <td class="p-3 whitespace-nowrap text-center text-sm text-gray-500">${item.universityNoticeViewCnt}</td>
                            <td class="p-3 whitespace-nowrap text-center text-sm text-gray-500">${item.universityNoticeUpdatedate.split(' ')[0]}</td>
                            <td class="p-3 whitespace-nowrap text-center text-sm text-gray-500">${item.universityNoticeCreatedate.split(' ')[0]}</td>
                        </tr>
                    `;
                    $tbody.append(row);
                });
            } else {
                const emptyRow = `<tr><td colspan="8" class="p-4 text-center text-gray-500 text-sm">ì¡°íšŒëœ ê³µì§€ì‚¬í•­ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
                $tbody.append(emptyRow);
            }
        }

        /**
         * í˜ì´ì§• HTMLì„ ë‹¤ì‹œ ìƒì„±í•©ë‹ˆë‹¤.
         */
        function updatePagination(currentPage, totalPages, searchCondition) {
            const $pagination = $('#pagination');
            $pagination.empty();
            const pagesToShow = 5;
            let startPage = Math.max(1, currentPage - Math.floor(pagesToShow / 2));
            let endPage = Math.min(totalPages, startPage + pagesToShow - 1);

            if (endPage - startPage + 1 < pagesToShow) {
                startPage = Math.max(1, endPage - pagesToShow + 1);
            }
            if (totalPages === 0) return;

            // Previous Button
            if (currentPage > 1) {
                $pagination.append(createPaginationLink(currentPage - 1, 'ì´ì „', searchCondition, false));
            }

            // Page links
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentPage;
                $pagination.append(createPaginationLink(i, i, searchCondition, isActive));
            }

            // Next Button
            if (currentPage < totalPages) {
                $pagination.append(createPaginationLink(currentPage + 1, 'ë‹¤ìŒ', searchCondition, false));
            }
        }

        /**
         * í˜ì´ì§• ë§í¬ ìš”ì†Œë¥¼ ìƒì„±í•˜ê³  ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.
         */
        function createPaginationLink(page, text, searchCondition, isActive) {
            const baseClass = 'px-3 py-1.5 text-sm rounded-lg mx-1 transition duration-150';
            const activeClass = 'bg-blue-600 text-white font-semibold';
            const inactiveClass = 'bg-gray-200 text-gray-700 hover:bg-gray-300';
            const className = isActive ? `${baseClass} ${activeClass} pagination-link` : `${baseClass} ${inactiveClass} pagination-link`;

            const $link = $('<button></button>')
                .addClass(className)
                .text(text)
                .data('page', page)
                .on('click', function(e) {
                    e.preventDefault();
                    loadNoticeList(page, searchCondition);
                });
            return $link;
        }

        // ==========================================================
        // 2. ê³µì§€ì‚¬í•­ ë“±ë¡ ë° ìˆ˜ì • (AJAX) - ê°±ì‹  ë¡œì§ ì¶”ê°€
        // ==========================================================
        $('#noticeForm').on('submit', function(e) {
            e.preventDefault();

            const action = currentMode === 'register' ? 'register' : 'update';
            const url = action === 'register' ? '/admin/insertUniversityNotice' : '/admin/updateUniversityNotice';

            // í¼ ë°ì´í„° ìˆ˜ì§‘ (ìˆ˜ì • ì‹œ universityNoticeNo í¬í•¨)
            const noticeData = {
                universityNoticeTitle: $('#universityNoticeTitle').val(),
                universityNoticeContent: $('#universityNoticeContent').val(),
                // ë“œë¡­ë‹¤ìš´ ê°’ì€ Stringì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ parseInt ì²˜ë¦¬
                universityNoticePriorityCode: parseInt($('#universityNoticePriorityCode').val()),
            };

            if (action === 'update') {
                // ìˆ˜ì • ì‹œì—ë§Œ ê³µì§€ ë²ˆí˜¸ í¬í•¨
                noticeData.universityNoticeNo = parseInt($('#universityNoticeNo').val());
            }

            if (!noticeData.universityNoticePriorityCode) {
                 alert('ìš°ì„ ìˆœìœ„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                 return;
            }

            $.ajax({
                url: url,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(noticeData),
                success: function(response) {
                    console.log("AJAX ì„±ê³µ, ì‘ë‹µ:", response);
                    alert(response.message);
                    if (response.status === 'success') {
                        closeNoticeModal();
                        
                        // â­ï¸ í•µì‹¬ ê°±ì‹  ë¡œì§ â­ï¸
                        const searchCondition = $('#searchUniversityNoticeCondition').val();
                        let pageToLoad = 1; // ë“±ë¡ ì„±ê³µ ì‹œ í•­ìƒ 1í˜ì´ì§€ë¡œ ì´ë™
                        
                        if (action === 'update') {
                            // ìˆ˜ì • ì„±ê³µ ì‹œ í˜„ì¬ í™œì„±í™”ëœ í˜ì´ì§€ ë²ˆí˜¸ë¥¼ ê°€ì ¸ì™€ ìœ ì§€
                            pageToLoad = $('.pagination-link.bg-blue-600').data('page') || 1;
                        }
                        
                        // ëª©ë¡ì„ ê°±ì‹ í•©ë‹ˆë‹¤.
                        loadNoticeList(pageToLoad, searchCondition);
                        
                    }
                },
                error: function(xhr) {
                    alert(`${action === 'register' ? 'ë“±ë¡' : 'ìˆ˜ì •'} ì¤‘ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`);
                    console.error('AJAX Error:', xhr);
                }
            });
        });


        // ==========================================================
        // 3. ìƒì„¸ ì¡°íšŒ (AJAX)
        // ==========================================================
        /**
         * ê³µì§€ ìƒì„¸ ì •ë³´ë¥¼ ë¡œë“œí•˜ê³  ëª¨ë‹¬ì— ë°”ì¸ë”©í•©ë‹ˆë‹¤.
         */
        function loadNoticeDetail(noticeNo) {
            $.ajax({
                url: '/admin/getUniversityNoticeDetail',
                type: 'GET',
                data: { universityNoticeNo: noticeNo },
                success: function(response) {
                    if (response.status === 'success') {
                        const detail = response.data;
                        originalDetailData = detail;

                        bindDetailData(detail, false);

                        currentMode = 'detail';
                        $('#detailButtons').removeClass('hidden');
                    } else {
                        alert(response.message);
                        closeNoticeModal();
                    }
                },
                error: function() {
                    alert('ìƒì„¸ ì •ë³´ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    closeNoticeModal();
                }
            });
        }

        /**
         * ìƒì„¸ ì •ë³´ë¥¼ ëª¨ë‹¬ í¼ì— ë°”ì¸ë”©í•˜ê³  í•„ë“œ ìƒíƒœë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
         */
        function bindDetailData(detail, isEditable) {
             const readOnlyClass = isEditable ? '' : 'bg-gray-100 cursor-not-allowed';
             const readOnlyProp = isEditable ? false : true;

             // í•­ìƒ readonlyì¸ í•„ë“œ
             $('#universityNoticeNo').val(detail.universityNoticeNo);
             $('#universityWriterUserName').val(detail.universityWriterUserName || 'ì•Œ ìˆ˜ ì—†ìŒ');
             $('#universityNoticeViewCnt').val(detail.universityNoticeViewCnt); 
             
             // ìˆ˜ì • ê°€ëŠ¥ í•„ë“œ (isEditableì— ë”°ë¼ ìƒíƒœ ë³€ê²½)
             $('#universityNoticeTitle').val(detail.universityNoticeTitle).prop('readonly', readOnlyProp).toggleClass('bg-gray-100 cursor-not-allowed', !isEditable);
             $('#universityNoticeContent').val(detail.universityNoticeContent).prop('readonly', readOnlyProp).toggleClass('bg-gray-100 cursor-not-allowed', !isEditable);
             $('#universityNoticePriorityCode').val(detail.universityNoticePriorityCode).prop('disabled', readOnlyProp).toggleClass('bg-gray-100 cursor-not-allowed', !isEditable);
        }

        // ==========================================================
        // 4. ë‹¤ì¤‘ ì‚­ì œ ê¸°ëŠ¥ (AJAX) - ê°±ì‹  ë¡œì§ ì¶”ê°€
        // ==========================================================

        /**
         * ì²´í¬ë°•ìŠ¤ ì„ íƒ ìƒíƒœì— ë”°ë¼ ì‚­ì œ ë²„íŠ¼ì„ í™œì„±í™”/ë¹„í™œì„±í™”í•©ë‹ˆë‹¤.
         */
        function updateDeleteButtonState() {
            const checkedCount = $('.notice-checkbox:checked').length;
            const $button = $('#removeSelectedBtn'); // ID ë³€ê²½
            if (checkedCount > 0) {
                $button.prop('disabled', false).removeClass('opacity-50 cursor-not-allowed');
            } else {
                $button.prop('disabled', true).addClass('opacity-50 cursor-not-allowed');
            }
        }

        // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        $('#selectAll').on('change', function() {
            $('.notice-checkbox').prop('checked', $(this).prop('checked'));
            updateDeleteButtonState();
        });

        // ê°œë³„ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ (ë™ì ìœ¼ë¡œ ì¶”ê°€ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ on('change') ì‚¬ìš©)
        $('#noticeListBody').on('change', '.notice-checkbox', function() {
            if (!$(this).prop('checked')) {
                $('#selectAll').prop('checked', false);
            } else if ($('.notice-checkbox').length === $('.notice-checkbox:checked').length) {
                $('#selectAll').prop('checked', true);
            }
            updateDeleteButtonState();
        });
        
        // ë‹¤ì¤‘ ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ID ìˆ˜ì •: deleteSelectedNotices -> removeSelectedBtn)
        $('#removeSelectedBtn').on('click', function() {
            const universityNoticeNoList = $('.notice-checkbox:checked').map(function() {
                return parseInt($(this).val());
            }).get();

            if (universityNoticeNoList.length === 0) {
                alert('ì‚­ì œí•  ê³µì§€ì‚¬í•­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!confirm(`ì„ íƒí•œ ${universityNoticeNoList.length}ê°œì˜ ê³µì§€ì‚¬í•­ì„ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }

            $.ajax({
                url: '/admin/removeUniversityNotice', // Controllerì˜ 6ë²ˆ ë§¤í•‘ ì‚¬ìš©
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ universityNoticeNoList: universityNoticeNoList }),
                success: function(response) {
                    alert(response.message);
                    if (response.status === 'success' || response.status === 'fail') {
                        // â­ï¸ ì‚­ì œ í›„ ëª©ë¡ ê°±ì‹  â­ï¸
                        const searchCondition = $('#searchUniversityNoticeCondition').val();
                        const pageToLoad = $('.pagination-link.bg-blue-600').data('page') || 1;
                        loadNoticeList(pageToLoad, searchCondition);
                    }
                },
                error: function(xhr) {
                    alert('ë‹¤ì¤‘ ì‚­ì œ ì¤‘ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    console.error('AJAX Error:', xhr);
                }
            });
        });

        // ==========================================================
        // 5. ê²€ìƒ‰ ë° ì´ˆê¸° ë¡œë“œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë° ë™ì  ë°”ì¸ë”© ì¶”ê°€
        // ==========================================================
        
        // 1. ê³µì§€ ë“±ë¡ ë²„íŠ¼ ì´ë²¤íŠ¸ ë°”ì¸ë”© (HTMLì˜ onclick ì œê±° í›„)
        $('#openRegisterModalBtn').on('click', function() {
            openNoticeModal('register'); 
        });

        // 2. ëª©ë¡ì˜ ì œëª© í´ë¦­ ì‹œ ìƒì„¸ ì¡°íšŒ ì´ë²¤íŠ¸ ë°”ì¸ë”© (ë™ì  ìš”ì†Œì— ëŒ€í•´ .on() ì‚¬ìš©)
        // updateNoticeTable í•¨ìˆ˜ì—ì„œ HTML onclick ì†ì„±ì„ ì œê±°í–ˆìœ¼ë¯€ë¡œ ì´ ë°”ì¸ë”©ì´ í•„ìˆ˜ì…ë‹ˆë‹¤.
        $('#noticeListBody').on('click', '.detail-link', function() {
            // data-notice-no ì†ì„±ì—ì„œ ê³µì§€ ë²ˆí˜¸ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
            const noticeNo = $(this).data('notice-no'); 
            if (noticeNo) {
                openNoticeModal('detail', noticeNo);
            }
        });

        // 3. ê²€ìƒ‰ í¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (ê²€ìƒ‰ ì‹¤í–‰ ì‹œ 1í˜ì´ì§€ë¡œ ì´ë™)
        $('#searchForm').on('submit', function(e) {
            e.preventDefault();
            const condition = $('#searchUniversityNoticeCondition').val();
            loadNoticeList(1, condition); // ê²€ìƒ‰ ì‹œ 1í˜ì´ì§€ë¶€í„° ë‹¤ì‹œ ì‹œì‘
        });

        // ì´ˆê¸° ë¡œë“œ ì‹œ ëª©ë¡ ê°±ì‹  (Mustacheì—ì„œ ë°›ì€ ì´ˆê¸° ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í˜ì´ì§• ì¬êµ¬ì„±)
        if (!isNaN(initialTotalCount) && !isNaN(initialCurrentPage)) {
            // Math.ceil((double) totalCount / limit)ì™€ ë™ì¼í•œ ê³„ì‚°
            const initialTotalPages = Math.ceil(initialTotalCount / 10);
            updatePagination(initialCurrentPage, initialTotalPages, initialSearchCondition);
            $('#totalCountDisplay').text(`ê³µì§€ ëª©ë¡ (ì´ ${initialTotalCount}ê°œì˜ ê³µì§€)`);
        }
        
        // ì´ˆê¸° ë¡œë“œ ì‹œ ì‚­ì œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        updateDeleteButtonState();
        
    });
</script>

</body>
</html>